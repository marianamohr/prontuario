import{e as K,r,al as Q,j as e,B as u,T as a,L as B,P as X,am as Y}from"./index-DJlnvih6.js";import{i as W}from"./cpf-Bdeebvjv.js";import{A as Z}from"./Alert-CVqmUb3o.js";import{T as i}from"./TextField-CttgYVuf.js";import{F as $}from"./FormControlLabel-BcClaYQT.js";import{C as ee}from"./Checkbox-Bncplgv-.js";import{B as te}from"./Button-6qkZ5rwi.js";import"./Select-cu5oWY5i.js";function re(b,o,n,j,C,c){return[b,o,n,j,C,c].join(`
`)}function me(){const[b]=K(),o=b.get("token")||"",[n,j]=r.useState(null),[C,c]=r.useState(!!o),[F,D]=r.useState(!1),[L,q]=r.useState(!1),[m,s]=r.useState(""),[h,I]=r.useState(!1),[P,k]=r.useState(""),[l,N]=r.useState(""),[S,A]=r.useState(""),[E,T]=r.useState(""),[y,R]=r.useState(""),[x,G]=r.useState(""),[p,O]=r.useState(""),[g,U]=r.useState(""),[f,w]=r.useState(""),[v,z]=r.useState(""),[d,M]=r.useState("");r.useEffect(()=>{if(!o){c(!1);return}Q(o).then(t=>{j(t),k(t.full_name||"")}).catch(()=>s("Link inválido ou expirado.")).finally(()=>c(!1))},[o]);const V=r.useMemo(()=>re(x.trim(),p.trim(),g.trim(),f.trim(),v.trim(),d.replace(/\D/g,"")),[x,p,g,f,v,d]),H=async t=>{if(t.preventDefault(),s(""),!P.trim()){s("Nome do responsável é obrigatório.");return}if(!l.trim()){s("CPF do responsável é obrigatório.");return}if(!W(l)){s("CPF inválido.");return}if(!x.trim()||!p.trim()||!g.trim()||!f.trim()||!v.trim()||!d.trim()){s("Preencha o endereço completo: Rua, Bairro, Cidade, Estado, País e CEP.");return}if(d.replace(/\D/g,"").length!==8){s("CEP deve ter 8 dígitos.");return}if(!S.trim()){s("Data de nascimento do responsável é obrigatória.");return}if(!y.trim()){s("Data de nascimento do paciente é obrigatória.");return}D(!0);try{await Y({token:o,same_person:h,guardian_full_name:P.trim(),guardian_cpf:l.trim(),guardian_address:V,guardian_birth_date:S.trim(),patient_full_name:h?"":E.trim(),patient_birth_date:y.trim()}),q(!0)}catch(_){const J=_ instanceof Error?_.message:"Não foi possível concluir o cadastro.";s(J)}finally{D(!1)}};return o?C?e.jsx(u,{sx:{maxWidth:520,mx:"auto",p:2},children:e.jsx(a,{color:"text.secondary",children:"Carregando..."})}):m&&!n?e.jsxs(u,{sx:{maxWidth:520,mx:"auto",p:2,textAlign:"center"},children:[e.jsx(a,{variant:"h5",sx:{mb:.5},children:"Link inválido ou expirado"}),e.jsx(a,{children:m}),e.jsx(a,{sx:{mt:2},children:e.jsx(B,{to:"/login",style:{color:"inherit"},children:"Ir para o login"})})]}):L?e.jsxs(u,{sx:{maxWidth:520,mx:"auto",p:2,textAlign:"center"},children:[e.jsx(a,{variant:"h5",sx:{mb:.5},children:"Cadastro concluído"}),e.jsx(a,{children:"Obrigado! O cadastro do paciente foi concluído."})]}):e.jsx(u,{sx:{maxWidth:560,mx:"auto",p:2},children:e.jsxs(X,{variant:"outlined",sx:{p:2},children:[e.jsx(a,{variant:"h5",sx:{mb:.5},children:"Completar cadastro"}),e.jsxs(a,{color:"text.secondary",sx:{mb:2,fontSize:14},children:["Convite enviado por ",e.jsx("b",{children:n==null?void 0:n.clinic_name}),". Preencha os dados abaixo."]}),e.jsxs(u,{component:"form",onSubmit:H,sx:{display:"flex",flexDirection:"column",gap:1.5},children:[m&&e.jsx(Z,{severity:"error",children:m}),e.jsx(i,{label:"E-mail do responsável",value:(n==null?void 0:n.email)??"",InputProps:{readOnly:!0},fullWidth:!0}),e.jsx($,{control:e.jsx(ee,{checked:h,onChange:t=>I(t.target.checked)}),label:"Paciente e responsável são a mesma pessoa"}),e.jsx(i,{label:"Nome do responsável",value:P,onChange:t=>k(t.target.value),required:!0,fullWidth:!0}),e.jsx(i,{label:"CPF do responsável",value:l,onChange:t=>N(t.target.value),required:!0,fullWidth:!0,placeholder:"000.000.000-00",inputProps:{maxLength:14},error:!!l.trim()&&!W(l),helperText:l.trim()&&!W(l)?"CPF inválido.":" "}),e.jsx(i,{label:"Data de nascimento do responsável",type:"date",value:S,onChange:t=>A(t.target.value),InputLabelProps:{shrink:!0},required:!0,fullWidth:!0}),e.jsx(a,{variant:"subtitle2",color:"text.secondary",sx:{mt:.5},children:"Endereço"}),e.jsx(i,{label:"Rua",value:x,onChange:t=>G(t.target.value),required:!0,fullWidth:!0}),e.jsx(i,{label:"Bairro",value:p,onChange:t=>O(t.target.value),required:!0,fullWidth:!0}),e.jsx(i,{label:"Cidade",value:g,onChange:t=>U(t.target.value),required:!0,fullWidth:!0}),e.jsx(i,{label:"Estado",value:f,onChange:t=>w(t.target.value),required:!0,placeholder:"UF",inputProps:{maxLength:2},fullWidth:!0}),e.jsx(i,{label:"País",value:v,onChange:t=>z(t.target.value),required:!0,fullWidth:!0}),e.jsx(i,{label:"CEP",value:d,onChange:t=>M(t.target.value),required:!0,placeholder:"00000000",inputProps:{maxLength:9},fullWidth:!0}),!h&&e.jsx(i,{label:"Nome do paciente",value:E,onChange:t=>T(t.target.value),required:!0,fullWidth:!0}),e.jsx(i,{label:"Data de nascimento do paciente",type:"date",value:y,onChange:t=>R(t.target.value),InputLabelProps:{shrink:!0},required:!0,fullWidth:!0}),e.jsx(te,{type:"submit",variant:"contained",disabled:F,sx:{mt:.5},children:F?"Salvando...":"Concluir cadastro"})]})]})}):e.jsxs(u,{sx:{maxWidth:520,mx:"auto",p:2,textAlign:"center"},children:[e.jsx(a,{variant:"h5",sx:{mb:.5},children:"Link inválido"}),e.jsx(a,{children:"Use o link recebido por e-mail para acessar o formulário."}),e.jsx(a,{sx:{mt:2},children:e.jsx(B,{to:"/login",style:{color:"inherit"},children:"Ir para o login"})})]})}export{me as RegisterPatient};
