import{u as E,r,aS as M,j as n,T as l,B as _,P as C,V as k,aT as N,aU as B}from"./index-DJlnvih6.js";import{P as y}from"./PageContainer-DrcGApUY.js";import{F as q}from"./FormControlLabel-BcClaYQT.js";import{C as R}from"./Checkbox-Bncplgv-.js";import{F as S,I as w,S as I}from"./Select-cu5oWY5i.js";import{B as P}from"./Button-6qkZ5rwi.js";import{T as d}from"./TextField-CttgYVuf.js";const s=["Domingo","Segunda","Terça","Quarta","Quinta","Sexta","Sábado"];function H(){const{user:o}=E(),[p,i]=r.useState([]),[D,F]=r.useState(!0),[b,j]=r.useState(!1),[f,u]=r.useState(""),[h,W]=r.useState(1),[c,A]=r.useState(2);r.useEffect(()=>{M().then(e=>{const a=e.days||[];a.length===7?i(a.map(t=>({...t,enabled:!!t.enabled}))):i(Array.from({length:7},(t,x)=>({day_of_week:x,enabled:!1,start_time:null,end_time:null,consultation_duration_minutes:50,interval_minutes:10,lunch_start:null,lunch_end:null})))}).catch(()=>{i(Array.from({length:7},(e,a)=>({day_of_week:a,enabled:!1,start_time:null,end_time:null,consultation_duration_minutes:50,interval_minutes:10,lunch_start:null,lunch_end:null})))}).finally(()=>F(!1))},[]);const z=async()=>{j(!0),u("");const e=p.map(a=>({day_of_week:a.day_of_week,enabled:a.enabled,start_time:a.start_time||null,end_time:a.end_time||null,consultation_duration_minutes:a.consultation_duration_minutes,interval_minutes:a.interval_minutes,lunch_start:a.lunch_start||null,lunch_end:a.lunch_end||null}));try{await B(e),u("Configuração salva.")}catch{u("Falha ao salvar.")}finally{j(!1)}},T=async()=>{if(h!==c){u("");try{await N(h,c),u(`Configuração do ${s[h]} copiada para ${s[c]}.`),i(e=>{const a=e.find(t=>t.day_of_week===h);return a?e.map(t=>t.day_of_week===c?{...a,day_of_week:c,enabled:!0}:t):e})}catch{u("Falha ao copiar.")}}},L=e=>{i(a=>a.map(t=>t.day_of_week===e?{...t,enabled:!t.enabled}:t))},m=(e,a,t)=>{i(x=>x.map(g=>g.day_of_week===e?{...g,[a]:t}:g))};if((o==null?void 0:o.role)!=="PROFESSIONAL"&&(o==null?void 0:o.role)!=="SUPER_ADMIN")return n.jsx(y,{children:n.jsx(l,{children:"Apenas profissionais podem configurar a agenda."})});if(D)return n.jsx(y,{children:n.jsx(l,{color:"text.secondary",children:"Carregando..."})});const v=p.filter(e=>e.enabled);return n.jsxs(y,{children:[n.jsx(l,{variant:"h4",sx:{mb:2},children:"Configurar agenda"}),n.jsx(l,{color:"text.secondary",sx:{mb:2},children:"Marque os dias da semana em que você atende. Só os dias marcados aparecem para configurar horários e na agenda."}),n.jsxs(_,{sx:{mb:2},children:[n.jsx(l,{fontWeight:600,sx:{mb:.5},children:"Dias de atendimento"}),n.jsx(_,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:p.map(e=>n.jsx(q,{control:n.jsx(R,{checked:e.enabled,onChange:()=>L(e.day_of_week)}),label:s[e.day_of_week]},e.day_of_week))})]}),v.length>0&&n.jsxs(C,{variant:"outlined",sx:{p:2,mb:2,bgcolor:"grey.50"},children:[n.jsx(l,{fontWeight:600,children:"Copiar um dia para outro"}),n.jsxs(_,{sx:{display:"flex",gap:.5,alignItems:"center",flexWrap:"wrap",mt:.5},children:[n.jsxs(S,{size:"small",sx:{minWidth:140},children:[n.jsx(w,{children:"De"}),n.jsx(I,{value:h,label:"De",onChange:e=>W(Number(e.target.value)),children:s.map((e,a)=>n.jsx(k,{value:a,children:s[a]},a))})]}),n.jsx(l,{children:"→"}),n.jsxs(S,{size:"small",sx:{minWidth:140},children:[n.jsx(w,{children:"Para"}),n.jsx(I,{value:c,label:"Para",onChange:e=>A(Number(e.target.value)),children:s.map((e,a)=>n.jsx(k,{value:a,children:s[a]},a))})]}),n.jsx(P,{variant:"contained",size:"small",onClick:T,children:"Copiar"})]})]}),f&&n.jsx(l,{sx:{mb:2,color:f.includes("Falha")?"error.main":"success.main"},children:f}),v.length===0?n.jsx(l,{color:"text.secondary",children:"Marque pelo menos um dia acima para configurar horários."}):n.jsxs(n.Fragment,{children:[n.jsx(_,{sx:{display:"flex",flexDirection:"column",gap:2},children:p.filter(e=>e.enabled).map(e=>n.jsxs(C,{variant:"outlined",sx:{p:2},children:[n.jsx(l,{variant:"subtitle1",fontWeight:600,sx:{mb:1},children:s[e.day_of_week]}),n.jsxs(_,{sx:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(140px, 1fr))",gap:1},children:[n.jsx(d,{type:"time",label:"Início",size:"small",value:e.start_time||"",onChange:a=>m(e.day_of_week,"start_time",a.target.value),InputLabelProps:{shrink:!0},fullWidth:!0}),n.jsx(d,{type:"time",label:"Fim",size:"small",value:e.end_time||"",onChange:a=>m(e.day_of_week,"end_time",a.target.value),InputLabelProps:{shrink:!0},fullWidth:!0}),n.jsx(d,{type:"number",label:"Duração consulta (min)",size:"small",inputProps:{min:5,max:120},value:e.consultation_duration_minutes,onChange:a=>m(e.day_of_week,"consultation_duration_minutes",parseInt(a.target.value,10)||50),fullWidth:!0}),n.jsx(d,{type:"number",label:"Intervalo (min)",size:"small",inputProps:{min:0,max:60},value:e.interval_minutes,onChange:a=>m(e.day_of_week,"interval_minutes",parseInt(a.target.value,10)||10),fullWidth:!0}),n.jsx(d,{type:"time",label:"Almoço início",size:"small",value:e.lunch_start||"",onChange:a=>m(e.day_of_week,"lunch_start",a.target.value),InputLabelProps:{shrink:!0},fullWidth:!0}),n.jsx(d,{type:"time",label:"Almoço fim",size:"small",value:e.lunch_end||"",onChange:a=>m(e.day_of_week,"lunch_end",a.target.value),InputLabelProps:{shrink:!0},fullWidth:!0})]})]},e.day_of_week))}),n.jsx(P,{variant:"contained",onClick:z,disabled:b,sx:{mt:2},children:b?"Salvando...":"Salvar configuração"})]})]})}export{H as ScheduleConfig};
