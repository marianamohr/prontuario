import{q as le,t as ce,r as n,v as de,an as Q,j as e,w as Z,y as me,z as ee,a2 as ye,Q as Se,ao as ae,E as Ce,ap as Ae,h as Ie,u as Pe,aq as Ee,ac as Re,B as F,T as p,L as je,P as Y,ar as Le,as as Oe,at as se,au as ne,av as Te,aw as Ne,ax as De}from"./index-DJlnvih6.js";import{h as re}from"./html2pdf-CQmOXuT7.js";import{E as we}from"./Edit-BNNIOXB7.js";import{D as Fe}from"./DeleteOutline-CllXSIWN.js";import{P as _e}from"./PageContainer-DrcGApUY.js";import{A as Me}from"./AppDialog-C8ethuMW.js";import{B as y}from"./Button-6qkZ5rwi.js";import{A as K}from"./Alert-CVqmUb3o.js";import{i as ke}from"./Select-cu5oWY5i.js";import{T as X}from"./TextField-CttgYVuf.js";function Ue(r){return le("MuiListItem",r)}ce("MuiListItem",["root","container","dense","alignItemsFlexStart","divider","gutters","padding","secondaryAction"]);function ze(r){return le("MuiListItemSecondaryAction",r)}ce("MuiListItemSecondaryAction",["root","disableGutters"]);const Ge=r=>{const{disableGutters:o,classes:i}=r;return me({root:["root",o&&"disableGutters"]},ze,i)},Ve=ee("div",{name:"MuiListItemSecondaryAction",slot:"Root",overridesResolver:(r,o)=>{const{ownerState:i}=r;return[o.root,i.disableGutters&&o.disableGutters]}})({position:"absolute",right:16,top:"50%",transform:"translateY(-50%)",variants:[{props:({ownerState:r})=>r.disableGutters,style:{right:0}}]}),te=n.forwardRef(function(o,i){const u=de({props:o,name:"MuiListItemSecondaryAction"}),{className:v,...g}=u,I=n.useContext(Q),d={...u,disableGutters:I.disableGutters},x=Ge(d);return e.jsx(Ve,{className:Z(x.root,v),ownerState:d,ref:i,...g})});te.muiName="ListItemSecondaryAction";const We=(r,o)=>{const{ownerState:i}=r;return[o.root,i.dense&&o.dense,i.alignItems==="flex-start"&&o.alignItemsFlexStart,i.divider&&o.divider,!i.disableGutters&&o.gutters,!i.disablePadding&&o.padding,i.hasSecondaryAction&&o.secondaryAction]},Be=r=>{const{alignItems:o,classes:i,dense:u,disableGutters:v,disablePadding:g,divider:I,hasSecondaryAction:d}=r;return me({root:["root",u&&"dense",!v&&"gutters",!g&&"padding",I&&"divider",o==="flex-start"&&"alignItemsFlexStart",d&&"secondaryAction"],container:["container"],secondaryAction:["secondaryAction"]},Ue,i)},He=ee("div",{name:"MuiListItem",slot:"Root",overridesResolver:We})(Ce(({theme:r})=>({display:"flex",justifyContent:"flex-start",alignItems:"center",position:"relative",textDecoration:"none",width:"100%",boxSizing:"border-box",textAlign:"left",variants:[{props:({ownerState:o})=>!o.disablePadding,style:{paddingTop:8,paddingBottom:8}},{props:({ownerState:o})=>!o.disablePadding&&o.dense,style:{paddingTop:4,paddingBottom:4}},{props:({ownerState:o})=>!o.disablePadding&&!o.disableGutters,style:{paddingLeft:16,paddingRight:16}},{props:({ownerState:o})=>!o.disablePadding&&!!o.secondaryAction,style:{paddingRight:48}},{props:({ownerState:o})=>!!o.secondaryAction,style:{[`& > .${Ae.root}`]:{paddingRight:48}}},{props:{alignItems:"flex-start"},style:{alignItems:"flex-start"}},{props:({ownerState:o})=>o.divider,style:{borderBottom:`1px solid ${(r.vars||r).palette.divider}`,backgroundClip:"padding-box"}},{props:({ownerState:o})=>o.button,style:{transition:r.transitions.create("background-color",{duration:r.transitions.duration.shortest}),"&:hover":{textDecoration:"none",backgroundColor:(r.vars||r).palette.action.hover,"@media (hover: none)":{backgroundColor:"transparent"}}}},{props:({ownerState:o})=>o.hasSecondaryAction,style:{paddingRight:48}}]}))),qe=ee("li",{name:"MuiListItem",slot:"Container"})({position:"relative"}),$e=n.forwardRef(function(o,i){const u=de({props:o,name:"MuiListItem"}),{alignItems:v="center",children:g,className:I,component:d,components:x={},componentsProps:V={},ContainerComponent:h="li",ContainerProps:{className:_,...U}={},dense:P=!1,disableGutters:M=!1,disablePadding:W=!1,divider:B=!1,secondaryAction:S,slotProps:z={},slots:k={},...H}=u,m=n.useContext(Q),l=n.useMemo(()=>({dense:P||m.dense||!1,alignItems:v,disableGutters:M}),[v,m.dense,P,M]),E=n.useRef(null),b=n.Children.toArray(g),G=b.length&&ke(b[b.length-1],["ListItemSecondaryAction"]),C={...u,alignItems:v,dense:l.dense,disableGutters:M,disablePadding:W,divider:B,hasSecondaryAction:G},R=Be(C),j=ye(E,i),q={slots:k,slotProps:z},[A,$]=Se("secondaryAction",{elementType:te,externalForwardedProps:q,ownerState:C,className:R.secondaryAction}),L=k.root||x.Root||He,O=z.root||V.root||{},T={className:Z(R.root,O.className,I),...H};let f=d||"li";return G?(f=!T.component&&!d?"div":f,h==="li"&&(f==="li"?f="div":T.component==="li"&&(T.component="div")),e.jsx(Q.Provider,{value:l,children:e.jsxs(qe,{as:h,className:Z(R.container,_),ref:j,ownerState:C,...U,children:[e.jsx(L,{...O,...!ae(L)&&{as:f,ownerState:{...C,...O.ownerState}},...T,children:b}),b.pop()]})})):e.jsx(Q.Provider,{value:l,children:e.jsxs(L,{...O,as:f,ref:j,...!ae(L)&&{ownerState:{...C,...O.ownerState}},...T,children:[b,S&&e.jsx(A,{...$,children:S})]})})}),Je=Ie(e.jsx("path",{d:"M19 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.89-2-2-2m0 16H5V7h14zm-5.5-6c0 .83-.67 1.5-1.5 1.5s-1.5-.67-1.5-1.5.67-1.5 1.5-1.5 1.5.67 1.5 1.5M12 9c-2.73 0-5.06 1.66-6 4 .94 2.34 3.27 4 6 4s5.06-1.66 6-4c-.94-2.34-3.27-4-6-4m0 6.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5"})),Qe={name:"",body_html:""},ie={name:"Contrato de Prestação de Serviços",body_html:`<!DOCTYPE html>
<html>
<head><meta charset="utf-8">
<style>
  body { font-family: 'Georgia', 'Times New Roman', serif; margin: 0 auto; padding: 2rem 1.25rem; line-height: 1.65; color: #1f2937; font-size: 14px; }
  .doc-title { font-size: 1.1rem; font-weight: 700; letter-spacing: 0.02em; color: #111827; text-align: center; margin-bottom: 1.25rem; text-transform: uppercase; }
  .intro { margin-bottom: 1.5rem; color: #374151; }
  .block { margin-bottom: 1.25rem; }
  .label { font-size: 0.8rem; font-weight: 700; color: #374151; text-transform: uppercase; letter-spacing: 0.03em; margin-bottom: 0.25rem; }
  .value { color: #4b5563; }
  .clause { margin-bottom: 1.25rem; }
  .clause-title { font-size: 0.8rem; font-weight: 700; color: #111827; text-transform: uppercase; letter-spacing: 0.02em; margin-bottom: 0.35rem; }
  .clause-text { font-size: 0.9rem; color: #4b5563; line-height: 1.6; }
  .signatures { margin-top: 2rem; padding-top: 1.25rem; border-top: 1px solid #e5e7eb; }
  .sign-line { margin-bottom: 1rem; }
  .sign-label { font-size: 0.75rem; font-weight: 600; color: #6b7280; margin-bottom: 0.2rem; }
  .sign-value { min-height: 1.2em; color: #374151; }
</style>
</head>
<body>
<p class="doc-title">Contrato de Prestação de Serviços</p>
<p class="intro">Pelo presente instrumento particular, as partes abaixo qualificadas celebram o presente Contrato de Prestação de Serviços, que se regerá pelas cláusulas e condições a seguir:</p>
<div class="block"><p class="label">Contratado (prestador de serviços):</p><p class="value">[CONTRATADO]</p></div>
<div class="block"><p class="label">Contratante (responsável legal pelo paciente):</p><p class="value">[CONTRATANTE]</p></div>
<div class="block"><p class="label">Dados do paciente:</p><p class="value">Nome: [PACIENTE_NOME] &nbsp; Data de nascimento: [PACIENTE_NASCIMENTO]</p></div>
<div class="block"><p class="label">Dados do responsável legal:</p><p class="value">Nome: [RESPONSAVEL_NOME] | E-mail: [RESPONSAVEL_EMAIL] | CPF: [RESPONSAVEL_CPF]<br>Endereço: [RESPONSAVEL_ENDERECO] | Data de nascimento: [RESPONSAVEL_NASCIMENTO]</p></div>
<div class="clause"><p class="clause-title">Cláusula 1ª – Do objeto</p><p class="clause-text">O presente contrato tem por objeto a prestação de serviços de [TIPO_SERVICO], nas condições estabelecidas entre as partes.</p></div>
<div class="clause"><p class="clause-title">Cláusula 2ª – Da periodicidade</p><p class="clause-text">Os serviços serão prestados com periodicidade [PERIODICIDADE], conforme combinado entre as partes.</p></div>
<div class="clause"><p class="clause-title">Cláusula 3ª – Do prazo</p><p class="clause-text">O presente contrato tem data de início em [DATA_INICIO] e [DATA_FIM].</p></div>
<div class="clause"><p class="clause-title">Cláusula 4ª – Do valor</p><p class="clause-text">Os serviços têm [VALOR], conforme acordado entre as partes.</p></div>
<div class="clause"><p class="clause-title">Cláusula 5ª – Das condições gerais</p><p class="clause-text">Quaisquer alterações no presente contrato somente produzirão efeitos se formalizadas por escrito e assinadas pelas partes.</p></div>
<div class="signatures">
  <div class="sign-line"><p class="sign-label">Assinatura do profissional:</p><div class="sign-value">[ASSINATURA_PROFISSIONAL]</div></div>
  <p class="sign-label">Local: Joinville - SC — Data: [DATA]</p>
  <div class="sign-line" style="margin-top: 1rem;"><p class="sign-label">Responsável / Contratante</p><div class="sign-value">[ASSINATURA_RESPONSAVEL]</div></div>
</div>
</body>
</html>`};function rt(){const[r,o]=n.useState([]),[i,u]=n.useState(!0),[v,g]=n.useState(""),[I,d]=n.useState(!1),[x,V]=n.useState(null),[h,_]=n.useState(Qe),[U,P]=n.useState({tipoServico:""}),[M,W]=n.useState(!1),[B,S]=n.useState(!1),[z,k]=n.useState(null),[H,m]=n.useState(""),{user:l}=Pe(),[E,b]=n.useState(null),[G,C]=n.useState(!1),[R,j]=n.useState(!1),[q,A]=n.useState(""),$=n.useRef(null),L=n.useCallback(()=>{(l==null?void 0:l.role)==="PROFESSIONAL"&&(C(!0),A(""),Ee().then(a=>b(a.signature_image_data||null)).catch(()=>A("Falha ao carregar assinatura.")).finally(()=>C(!1)))},[l==null?void 0:l.role]);n.useEffect(()=>{L()},[L]);const O=a=>{var c;const t=(c=a.target.files)==null?void 0:c[0];if(!t||!t.type.startsWith("image/"))return;A(""),j(!0);const s=new FileReader;s.onload=()=>{const N=s.result;se(N).then(()=>{var D,w;b(N),(w=(D=$.current)==null?void 0:D.form)==null||w.reset()}).catch(()=>A("Falha ao enviar imagem.")).finally(()=>j(!1))},s.readAsDataURL(t)},T=()=>{window.confirm("Remover sua assinatura dos contratos?")&&(A(""),j(!0),se("").then(()=>b(null)).catch(()=>A("Falha ao remover.")).finally(()=>j(!1)))},f=n.useCallback(()=>{u(!0),Re().then(a=>o(a.templates)).catch(()=>g("Falha ao carregar modelos de contrato.")).finally(()=>u(!1))},[]);n.useEffect(()=>{f()},[f]);const pe=()=>{V(null),_({name:ie.name,body_html:ie.body_html}),P({tipoServico:""}),m(""),d(!0)},ue=a=>{V(a),P({tipoServico:""}),m(""),d(!0),ne(a).then(t=>{_({name:t.name,body_html:t.body_html}),P({tipoServico:t.tipo_servico??""})}).catch(()=>m("Falha ao carregar modelo."))},ge=async a=>{if(a.preventDefault(),m(""),!h.name.trim()){m("Nome é obrigatório.");return}W(!0);try{const t=U.tipoServico.trim();if(x){const s=r.find(c=>c.id===x);await Ne(x,h.name.trim(),h.body_html,(s==null?void 0:s.version)??1,t,"")}else await De(h.name.trim(),h.body_html,t,"");d(!1),f()}catch{m("Falha ao salvar.")}finally{W(!1)}},he=async a=>{if(window.confirm("Excluir este modelo de contrato?"))try{await Te(a),g(""),f()}catch(t){const s=t instanceof Error?t.message:"Falha ao excluir.";try{const c=JSON.parse(s);c!=null&&c.error?g(c.error):g("Falha ao excluir.")}catch{g(s||"Falha ao excluir.")}}};function fe(){let a=h.body_html.replace(/\[TIPO_SERVICO\]/g,U.tipoServico.trim()||"[não informado]").replace(/\[PERIODICIDADE\]/g,"[definido ao disparar o contrato]");const t="[ASSINATURA_PROFISSIONAL]";if(a.includes(t)){let s="";E?s=`<img src="${E}" alt="Assinatura do profissional" style="max-height:56px;max-width:200px;display:block;" />`:l!=null&&l.full_name&&(s=`<span style="font-family: 'Brush Script MT', 'Segoe Script', 'Dancing Script', cursive; font-size: 1.25em;">${l.full_name}</span>`),a=a.replace(new RegExp(t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"g"),s||t)}return a}const ve=()=>{m(""),S(!0);const a=fe(),t=document.createElement("iframe");t.setAttribute("style","position:absolute;width:210mm;height:297mm;left:-9999px;top:0;border:none;"),document.body.appendChild(t);const s=t.contentDocument;if(!s){S(!1),document.body.removeChild(t),m("Não foi possível gerar o preview.");return}s.open(),s.write(a),s.close(),t.onload=()=>{setTimeout(()=>{var D;const c=(D=t.contentDocument)==null?void 0:D.body;if(!c){S(!1),document.body.removeChild(t);return}const N={margin:10,filename:"preview-contrato.pdf",image:{type:"jpeg",quality:.98},html2canvas:{scale:2,useCORS:!0},jsPDF:{unit:"mm",format:"a4",orientation:"portrait"}};re().set(N).from(c).outputPdf("blob").then(w=>{const J=URL.createObjectURL(w);window.open(J,"_blank","noopener,noreferrer"),URL.revokeObjectURL(J),document.body.removeChild(t),S(!1)},()=>{document.body.contains(t)&&document.body.removeChild(t),S(!1),m("Falha ao gerar o PDF. Tente novamente.")})},100)}},be=(a,t)=>{const s=document.createElement("iframe");s.setAttribute("style","position:absolute;width:210mm;height:297mm;left:-9999px;top:0;border:none;"),document.body.appendChild(s);const c=s.contentDocument;if(!c){t(),document.body.removeChild(s);return}c.open(),c.write(a),c.close(),s.onload=()=>{setTimeout(()=>{var w;const N=(w=s.contentDocument)==null?void 0:w.body;if(!N){t(),document.body.removeChild(s);return}const D={margin:10,filename:"preview-contrato.pdf",image:{type:"jpeg",quality:.98},html2canvas:{scale:2,useCORS:!0},jsPDF:{unit:"mm",format:"a4",orientation:"portrait"}};re().set(D).from(N).outputPdf("blob").then(J=>{const oe=URL.createObjectURL(J);window.open(oe,"_blank","noopener,noreferrer"),URL.revokeObjectURL(oe),document.body.removeChild(s),t()},()=>{document.body.contains(s)&&document.body.removeChild(s),t()})},100)}},xe=a=>{k(a),ne(a).then(t=>be(t.body_html,()=>k(null)),()=>k(null))};return e.jsxs(_e,{maxWidth:"md",children:[e.jsx(F,{sx:{mb:1},children:e.jsx(p,{component:je,to:"/",sx:{color:"primary.main",textDecoration:"none",fontSize:14},children:"← Início"})}),e.jsxs(F,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:1,mb:2},children:[e.jsx(p,{variant:"h4",fontWeight:700,children:"Modelos de contrato"}),e.jsx(y,{variant:"contained",onClick:pe,children:"Novo modelo"})]}),e.jsx(p,{color:"text.secondary",sx:{mb:2,fontSize:14},children:"Cada profissional pode ter seus próprios modelos. Use-os ao disparar contratos para assinatura na tela do paciente."}),(l==null?void 0:l.role)==="PROFESSIONAL"&&e.jsxs(Y,{variant:"outlined",sx:{p:2,mb:2,bgcolor:"grey.50"},children:[e.jsx(p,{variant:"subtitle1",fontWeight:600,sx:{mb:1},children:"Minha assinatura"}),e.jsx(p,{variant:"body2",color:"text.secondary",sx:{mb:1},children:"A imagem será exibida nos contratos enviados por você. Use PNG ou JPEG (até 500 KB)."}),G&&e.jsx(p,{variant:"body2",color:"text.secondary",children:"Carregando..."}),!G&&e.jsxs(F,{sx:{display:"flex",flexWrap:"wrap",gap:.5,alignItems:"center"},children:[E&&e.jsx(F,{sx:{mb:1},children:e.jsx(F,{component:"img",src:E,alt:"Sua assinatura",sx:{maxHeight:56,maxWidth:200,border:"1px solid",borderColor:"divider",borderRadius:.5}})}),e.jsxs(y,{variant:"outlined",component:"label",disabled:R,size:"small",children:[e.jsx("input",{ref:$,type:"file",accept:"image/*",onChange:O,hidden:!0}),R?"Enviando...":"Escolher imagem da assinatura"]}),E&&e.jsx(y,{variant:"outlined",color:"error",size:"small",disabled:R,onClick:T,children:"Remover assinatura"})]}),q&&e.jsx(K,{severity:"error",sx:{mt:.5},children:q})]}),v&&e.jsx(K,{severity:"error",sx:{mb:2},children:v}),i&&e.jsx(p,{color:"text.secondary",children:"Carregando..."}),!i&&e.jsxs(Le,{disablePadding:!0,children:[r.map(a=>e.jsxs($e,{component:Y,variant:"outlined",sx:{mb:.75,borderRadius:1},children:[e.jsx(Oe,{primary:a.name,secondary:`v${a.version}`,primaryTypographyProps:{fontWeight:600}}),e.jsxs(te,{children:[e.jsx(y,{size:"small",variant:"contained",startIcon:e.jsx(Je,{}),disabled:z===a.id,onClick:()=>xe(a.id),sx:{mr:.5},children:z===a.id?"Gerando...":"Preview"}),e.jsx(y,{size:"small",variant:"outlined",startIcon:e.jsx(we,{}),onClick:()=>ue(a.id),sx:{mr:.5},children:"Editar"}),e.jsx(y,{size:"small",variant:"outlined",color:"error",startIcon:e.jsx(Fe,{}),onClick:()=>he(a.id),children:"Excluir"})]})]},a.id)),r.length===0&&e.jsx(Y,{variant:"outlined",sx:{p:2,textAlign:"center",borderStyle:"dashed"},children:e.jsx(p,{color:"text.secondary",children:"Nenhum modelo cadastrado. Crie um para enviar contratos aos responsáveis."})})]}),e.jsx(Me,{open:I,onClose:()=>d(!1),title:x?"Editar modelo":"Novo modelo",maxWidth:"md",children:e.jsxs(F,{component:"form",onSubmit:ge,children:[e.jsx(p,{variant:"caption",color:"text.secondary",fontWeight:600,sx:{display:"block",mb:.75,textTransform:"uppercase"},children:"Dados do modelo"}),e.jsx(X,{label:"Nome do modelo",fullWidth:!0,value:h.name,onChange:a=>_(t=>({...t,name:a.target.value})),placeholder:"Ex.: Contrato de Prestação de Serviços",sx:{mb:1}}),e.jsx(X,{label:"Tipo de serviço",fullWidth:!0,value:U.tipoServico,onChange:a=>P(t=>({...t,tipoServico:a.target.value})),placeholder:"Ex.: Fonoaudiologia",sx:{mb:1.5}}),e.jsx(p,{variant:"body2",color:"text.secondary",sx:{mb:.75},children:"Periodicidade, datas e valor são definidos na tela de disparar o contrato (por cliente)."}),e.jsx(p,{variant:"caption",color:"text.secondary",fontWeight:600,sx:{display:"block",mb:.75,textTransform:"uppercase"},children:"Conteúdo (HTML)"}),e.jsx(X,{label:"HTML do contrato",fullWidth:!0,multiline:!0,rows:14,value:h.body_html,onChange:a=>_(t=>({...t,body_html:a.target.value})),sx:{fontFamily:"monospace",fontSize:13,mb:.5}}),e.jsx(p,{variant:"caption",color:"text.disabled",sx:{display:"block",mb:1},children:"Placeholders: [CONTRATADO], [CONTRATANTE], [PACIENTE_NOME], [TIPO_SERVICO], [PERIODICIDADE], [VALOR], [ASSINATURA_PROFISSIONAL], [ASSINATURA_RESPONSAVEL], [DATA]. Escreva o local diretamente no texto (ex.: Joinville - SC). Apenas [DATA] é preenchida automaticamente na tela de assinatura (dia em que o responsável abriu o link, DD/MM/AAAA)."}),H&&e.jsx(K,{severity:"error",sx:{mb:1},children:H}),e.jsxs(F,{sx:{display:"flex",gap:1,flexWrap:"wrap"},children:[e.jsx(y,{variant:"outlined",onClick:ve,disabled:B,children:B?"Gerando PDF...":"Preview em PDF"}),e.jsx(y,{type:"submit",variant:"contained",color:"primary",disabled:M,children:M?"Salvando...":"Salvar"}),e.jsx(y,{type:"button",onClick:()=>d(!1),children:"Cancelar"})]})]})})]})}export{rt as ContractTemplates};
