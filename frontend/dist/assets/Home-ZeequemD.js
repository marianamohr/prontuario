import{u as b,j as e,N as E,a as N,r,l as B,b as L,T as s,B as a,P as g,C,L as v}from"./index-DJlnvih6.js";import{P as D}from"./PageContainer-DrcGApUY.js";import{B as S}from"./Button-6qkZ5rwi.js";function I(t){return t.toISOString().slice(0,10)}function O(t){if(!t)return"—";const[l,o]=t.split(":");return`${l??"00"}:${o??"00"}`}function z(){var y;const{user:t,isImpersonated:l}=b();if((t==null?void 0:t.role)==="SUPER_ADMIN"&&!l)return e.jsx(E,{to:"/backoffice/audit",replace:!0});const o=((y=N())==null?void 0:y.branding)??null,m=(t==null?void 0:t.role)==="PROFESSIONAL",P=m&&(o!=null&&o.primary_color)?o==null?void 0:o.primary_color:void 0,[p,x]=r.useState([]),[h,u]=r.useState([]),[A,c]=r.useState(!0),[_,d]=r.useState(!0),j=r.useCallback(()=>{if((t==null?void 0:t.role)!=="PROFESSIONAL"&&(t==null?void 0:t.role)!=="SUPER_ADMIN"){c(!1),d(!1);return}c(!0),B().then(i=>x(i.contracts||[])).catch(()=>x([])).finally(()=>c(!1));const n=I(new Date);d(!0),L(n,n).then(i=>u(i.appointments||[])).catch(()=>u([])).finally(()=>d(!1))},[t==null?void 0:t.role]);r.useEffect(()=>{j()},[j]);const f=(t==null?void 0:t.role)==="PROFESSIONAL"||(t==null?void 0:t.role)==="SUPER_ADMIN";return e.jsxs(D,{children:[e.jsx(s,{variant:"h4",sx:{mb:2,color:P},children:m&&(o!=null&&o.home_label)?`Bem-vindo ao ${o.home_label}`:"Bem-vindo ao Prontuário Saúde"}),f&&e.jsxs(a,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",md:"1fr 1fr"},gap:2},children:[e.jsxs(g,{variant:"outlined",sx:{p:2},children:[e.jsx(s,{variant:"h6",sx:{mb:1.5},children:"Contratos pendentes de assinatura"}),A?e.jsx(a,{sx:{display:"flex",justifyContent:"center",py:3},children:e.jsx(C,{size:24})}):p.length===0?e.jsx(s,{variant:"body2",color:"text.secondary",children:"Nenhum contrato pendente."}):e.jsx(a,{component:"ul",sx:{listStyle:"none",p:0,m:0},children:p.map(n=>e.jsxs(a,{component:"li",sx:{py:.75,borderBottom:1,borderColor:"divider","&:last-child":{borderBottom:0}},children:[e.jsxs(s,{variant:"body2",children:[e.jsx("strong",{children:n.template_name})," — ",n.patient_name," (",n.guardian_name,")"]}),e.jsx(S,{component:v,to:`/patients/${n.patient_id}/contracts`,size:"small",variant:"outlined",sx:{mt:.5},children:"Ver contratos"})]},n.id))})]}),e.jsxs(g,{variant:"outlined",sx:{p:2},children:[e.jsx(s,{variant:"h6",sx:{mb:1.5},children:"Agenda do dia"}),_?e.jsx(a,{sx:{display:"flex",justifyContent:"center",py:3},children:e.jsx(C,{size:24})}):h.length===0?e.jsx(s,{variant:"body2",color:"text.secondary",children:"Nenhum agendamento para hoje."}):e.jsx(a,{component:"ul",sx:{listStyle:"none",p:0,m:0},children:h.filter(n=>n.status!=="CANCELLED").sort((n,i)=>(n.start_time||"").localeCompare(i.start_time||"")).map(n=>e.jsx(a,{component:"li",sx:{py:.75,borderBottom:1,borderColor:"divider","&:last-child":{borderBottom:0}},children:e.jsxs(s,{variant:"body2",children:[e.jsx("strong",{children:O(n.start_time)})," — ",n.patient_name||"Paciente",n.status&&n.status!=="CONFIRMED"&&e.jsxs(s,{component:"span",variant:"caption",color:"text.secondary",sx:{ml:.5},children:["(",n.status==="COMPLETED"?"Concluído":n.status,")"]})]})},n.id))}),e.jsx(S,{component:v,to:"/agenda",variant:"outlined",size:"small",sx:{mt:1.5},children:"Ver agenda completa"})]})]}),!f&&e.jsx(s,{color:"text.secondary",children:"Acesse o menu para navegar."})]})}export{z as Home};
