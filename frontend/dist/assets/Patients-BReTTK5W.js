import{h as Vt,j as e,u as Ut,a as qt,r as a,i as $t,T as C,L as Ge,B as x,C as Xt,P as Jt,I as y,D as Kt,k as Qt,m as Yt,s as Zt,n as St,o as ea,p as ta}from"./index-DJlnvih6.js";import{E as aa}from"./Edit-BNNIOXB7.js";import{D as ia}from"./DeleteOutline-CllXSIWN.js";import{V as _e,a as Ie}from"./VisibilityOff-BuKH-pgV.js";import{P as yt}from"./PageContainer-DrcGApUY.js";import{A as De}from"./AppDialog-C8ethuMW.js";import{i as m,n as $}from"./cpf-Bdeebvjv.js";import{B as p}from"./Button-6qkZ5rwi.js";import{A as N}from"./Alert-CVqmUb3o.js";import{T as ra,a as na,b as sa,c as Ft,d as I,e as oa}from"./TableRow-Bh5fPPOD.js";import{F as la}from"./FormControlLabel-BcClaYQT.js";import{C as da}from"./Checkbox-Bncplgv-.js";import{T as r}from"./TextField-CttgYVuf.js";import{I as We}from"./InputAdornment-KMMRGF9J.js";import"./Select-cu5oWY5i.js";const ca=Vt(e.jsx("path",{d:"M19 3h-4.18C14.4 1.84 13.3 1 12 1s-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1m2 14H7v-2h7zm3-4H7v-2h10zm0-4H7V7h10z"})),ua="#16a34a",ma="#dc2626",we=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;function Gt(n,l,d,c,g,b){return[n,l,d,c,g,b].join(`
`)}function pa(n){var d,c,g,b,k,D;if(!(n!=null&&n.trim()))return["","","","","",""];const l=n.split(`
`);return[((d=l[0])==null?void 0:d.trim())??"",((c=l[1])==null?void 0:c.trim())??"",((g=l[2])==null?void 0:g.trim())??"",((b=l[3])==null?void 0:b.trim())??"",((k=l[4])==null?void 0:k.trim())??"",((D=l[5])==null?void 0:D.trim())??""]}function ha(n){if(!n)return"—";const l=new Date(n+"T12:00:00");return Number.isNaN(l.getTime())?n:l.toLocaleDateString("pt-BR")}function Da(){var Pt;const{user:n,isImpersonated:l}=Ut(),d=((Pt=qt())==null?void 0:Pt.branding)??null,c=(n==null?void 0:n.role)==="PROFESSIONAL"&&(d!=null&&d.action_button_color)?d.action_button_color:ua,g=(n==null?void 0:n.role)==="PROFESSIONAL"&&(d!=null&&d.negation_button_color)?d.negation_button_color:ma,[b,k]=a.useState([]),[D,Ne]=a.useState(!0),[X,J]=a.useState(""),[_t,ke]=a.useState(null),[It,A]=a.useState(!1),[Dt,K]=a.useState(!1),[Ae,Be]=a.useState(""),[Te,Le]=a.useState(""),[Oe,Q]=a.useState(!1),[Re,B]=a.useState(""),[F,ze]=a.useState(!1),[j,Me]=a.useState(""),[P,He]=a.useState(""),[v,Ve]=a.useState(""),[h,Ue]=a.useState(""),[Y,qe]=a.useState(!1),[Z,$e]=a.useState(""),[ee,Xe]=a.useState(""),[te,Je]=a.useState(""),[ae,Ke]=a.useState(""),[ie,Qe]=a.useState(""),[T,Ye]=a.useState(""),[re,Ze]=a.useState(""),[et,tt]=a.useState(""),[W,at]=a.useState(""),[ne,it]=a.useState(""),[rt,nt]=a.useState(!1),[L,s]=a.useState(""),[Wt,st]=a.useState(!1),[O,ot]=a.useState(null),[se,oe]=a.useState(""),[lt,le]=a.useState(""),[dt,de]=a.useState(""),[E,ce]=a.useState(""),[wt,ct]=a.useState(""),[ue,ut]=a.useState(!1),[mt,me]=a.useState(""),[R,pe]=a.useState(""),[z,he]=a.useState(""),[M,fe]=a.useState(""),[H,xe]=a.useState(""),[V,ge]=a.useState(""),[U,ve]=a.useState(""),[w,Ce]=a.useState(""),[pt,be]=a.useState(""),[ht,je]=a.useState(""),[f,Pe]=a.useState(""),[Nt,ft]=a.useState(""),[xt,S]=a.useState(!1),[gt,u]=a.useState(""),[Ee,vt]=a.useState(!1),[Se,Ct]=a.useState(null),[ye,bt]=a.useState(!1),G=a.useCallback(()=>{Ne(!0),$t().then(t=>k(t.patients)).catch(()=>J("Falha ao carregar pacientes.")).finally(()=>Ne(!1))},[]);a.useEffect(()=>{G()},[G]);const Fe=()=>{ze(!1),Me(""),He(""),Ve(""),Ue(""),qe(!1),$e(""),Xe(""),Je(""),Ke(""),Qe(""),Ye(""),Ze(""),tt(""),at(""),it(""),s("")},jt=()=>{Be(""),Le(""),Q(!1),B(""),s("")},kt=async t=>{t.preventDefault(),s("");const i=P.trim()!=="";if(i){if(!j.trim()){s("Nome do responsável é obrigatório.");return}if(!we.test(P.trim())){s("E-mail do responsável inválido.");return}if(!v.trim()){s("CPF do responsável é obrigatório.");return}if(!m(v)){s("CPF do responsável inválido.");return}if(!Z.trim()||!ee.trim()||!te.trim()||!ae.trim()||!ie.trim()||!T.trim()){s("Preencha todos os campos do endereço: Rua, Bairro, Cidade, Estado, País e CEP.");return}if(T.replace(/\D/g,"").length!==8){s("CEP deve ter 8 dígitos.");return}if(!re.trim()){s("Data de nascimento do responsável é obrigatória.");return}if(!ne.trim()){s("Data de nascimento do paciente é obrigatória.");return}}else if(!j.trim()&&!W.trim()){s("Informe o nome do responsável ou do paciente.");return}if(h.trim()&&!m(h)){s("CPF do paciente inválido.");return}nt(!0);try{const o=ne.trim()||void 0;i?await St({full_name:j.trim(),birth_date:o,patient_cpf:h.trim()||void 0,same_person:F,guardian_full_name:j.trim(),guardian_email:P.trim(),guardian_cpf:v.trim(),guardian_address:Gt(Z.trim(),ee.trim(),te.trim(),ae.trim(),ie.trim(),T.replace(/\D/g,"")),guardian_birth_date:re.trim(),guardian_phone:et.trim()||void 0,patient_full_name:F?"":W.trim()}):await St({full_name:((F?j:W)||j||W).trim(),birth_date:o,patient_cpf:h.trim()||void 0}),Fe(),A(!1),G()}catch{s("Falha ao cadastrar paciente.")}finally{nt(!1)}},At=t=>{ot(t.id),u(""),st(!0),oe(""),le(""),de(""),ce(""),ct(""),ut(!1),me(""),pe(""),he(""),fe(""),xe(""),ge(""),ve(""),Ce(""),be(""),je(""),Pe(""),ft(""),vt(!1),Ct(null),bt(!1),Yt(t.id).then(i=>{oe(i.full_name??""),le(i.birth_date??""),de(i.email??"");const o=i.cpf?String(i.cpf):"";if(ce(o),ct($(o)),i.guardian){vt(!0),Ct(i.guardian.id??null),me(i.guardian.full_name??""),pe(i.guardian.email??"");const[_,Ot,Rt,zt,Mt,Ht]=pa(i.guardian.address??void 0);he(_),fe(Ot),xe(Rt),ge(zt),ve(Mt),Ce(Ht),be(i.guardian.birth_date??""),je(i.guardian.phone??"");const Et=i.guardian.cpf?String(i.guardian.cpf):"";Pe(Et),ft($(Et))}}).catch(()=>u("Falha ao carregar paciente."))},q=()=>{st(!1),ot(null),u("")},Bt=async t=>{if(t.preventDefault(),!!O){if(u(""),!se.trim()){u("Nome do paciente é obrigatório.");return}S(!0);try{const i={full_name:se.trim(),birth_date:lt.trim()||void 0,email:dt.trim()||void 0};if($(E)!==wt&&(i.patient_cpf=E.trim(),i.patient_cpf&&!m(i.patient_cpf))){u("CPF do paciente inválido."),S(!1);return}if(Ee){if(R.trim()&&!we.test(R.trim())){u("E-mail do responsável inválido."),S(!1);return}const o=z.trim()||M.trim()||H.trim()||V.trim()||U.trim()||w.trim();if(o){if(!z.trim()||!M.trim()||!H.trim()||!V.trim()||!U.trim()||!w.trim()){u("Preencha todos os campos do endereço: Rua, Bairro, Cidade, Estado, País e CEP."),S(!1);return}if(w.replace(/\D/g,"").length!==8){u("CEP deve ter 8 dígitos."),S(!1);return}}if(i.guardian_full_name=mt.trim()||void 0,i.guardian_email=R.trim()||void 0,i.guardian_address=o?Gt(z.trim(),M.trim(),H.trim(),V.trim(),U.trim(),w.replace(/\D/g,"")):void 0,i.guardian_birth_date=pt.trim()||void 0,i.guardian_phone=ht.trim()||void 0,f.trim()){if(!m(f)){u("CPF do responsável inválido."),S(!1);return}const _=$(f);_&&_!==Nt&&(i.guardian_cpf=f.trim())}}await ea(O,i),q(),G()}catch{u("Falha ao atualizar paciente.")}finally{S(!1)}}},Tt=async t=>{if(window.confirm("Tem certeza que deseja excluir (soft delete) este paciente? Ele vai sumir do front para profissionais.")){ke(t);try{await Zt(t),G()}catch{J("Falha ao excluir paciente.")}finally{ke(null)}}},Lt=async()=>{if(!(!O||!Se||!window.confirm("Tem certeza que deseja excluir (soft delete) este responsável? Ele vai sumir do front para profissionais.")))try{await ta(O,Se),q(),G()}catch{u("Falha ao excluir responsável.")}};return(n==null?void 0:n.role)==="SUPER_ADMIN"?e.jsxs(yt,{children:[e.jsx(C,{sx:{mb:2},children:"Como super admin, use o backoffice para gestão. Pacientes são listados por clínica no contexto do profissional."}),e.jsx(p,{component:Ge,to:"/backoffice",variant:"contained",children:"Ir para Backoffice"})]}):e.jsxs(yt,{children:[e.jsxs(x,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:1,mb:2},children:[e.jsx(C,{variant:"h1",sx:{margin:0},children:"Pacientes"}),e.jsxs(x,{sx:{display:"flex",gap:1,flexWrap:"wrap"},children:[e.jsx(p,{variant:"outlined",onClick:()=>{K(!0),B(""),s("")},children:"Enviar invite para paciente"}),e.jsx(p,{variant:"contained",onClick:()=>A(!0),sx:{bgcolor:c,"&:hover":{bgcolor:c,opacity:.9}},children:"Novo paciente"})]})]}),X&&e.jsx(N,{severity:"error",sx:{mb:2},onClose:()=>J(""),children:X}),D&&e.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:1,py:3},children:[e.jsx(Xt,{size:20}),e.jsx(C,{color:"text.secondary",children:"Carregando..."})]}),!D&&!X&&e.jsxs(ra,{component:Jt,sx:{overflowX:"auto"},children:[e.jsxs(na,{size:"medium",sx:{minWidth:320},children:[e.jsx(sa,{children:e.jsxs(Ft,{sx:{bgcolor:"grey.50"},children:[e.jsx(I,{sx:{fontWeight:600,color:"text.secondary"},children:"Paciente"}),e.jsx(I,{sx:{fontWeight:600,color:"text.secondary"},children:"Data de nascimento"}),e.jsx(I,{align:"right",sx:{fontWeight:600,color:"text.secondary"},children:"Ações"})]})}),e.jsx(oa,{children:b.map(t=>e.jsxs(Ft,{hover:!0,children:[e.jsx(I,{sx:{fontWeight:500},children:t.full_name}),e.jsx(I,{color:"text.secondary",children:ha(t.birth_date)}),e.jsxs(I,{align:"right",children:[e.jsx(y,{size:"small",onClick:()=>At(t),title:"Editar paciente","aria-label":"Editar paciente",children:e.jsx(aa,{fontSize:"small"})}),e.jsx(y,{size:"small",component:Ge,to:`/patients/${t.id}/contracts`,title:"Gerenciar contratos","aria-label":"Gerenciar contratos",children:e.jsx(ca,{fontSize:"small"})}),e.jsx(y,{size:"small",component:Ge,to:`/patients/${t.id}/prontuario`,title:"Prontuário","aria-label":"Prontuário",sx:{bgcolor:c,color:"white","&:hover":{bgcolor:c,opacity:.9}},children:e.jsx(Kt,{fontSize:"small"})}),l&&e.jsx(y,{size:"small",title:"Excluir paciente","aria-label":"Excluir paciente",color:"error",disabled:_t===t.id,onClick:()=>Tt(t.id),children:e.jsx(ia,{fontSize:"small"})})]})]},t.id))})]}),b.length===0&&e.jsx(x,{sx:{py:4,textAlign:"center"},children:e.jsx(C,{color:"text.secondary",children:"Nenhum paciente cadastrado."})})]}),e.jsx(De,{open:It,onClose:()=>{A(!1),Fe()},title:"Novo paciente",actions:e.jsxs(e.Fragment,{children:[e.jsx(p,{onClick:()=>{A(!1),Fe()},color:"inherit",sx:{color:g},children:"Cancelar"}),e.jsx(p,{variant:"contained",type:"submit",form:"new-patient-form",disabled:rt,sx:{bgcolor:c,"&:hover":{bgcolor:c,opacity:.9}},children:rt?"Salvando...":"Cadastrar"})]}),children:e.jsx("form",{id:"new-patient-form",onSubmit:kt,children:e.jsxs(x,{sx:{display:"flex",flexDirection:"column",gap:2,pt:.5},children:[e.jsx(la,{control:e.jsx(da,{checked:F,onChange:t=>ze(t.target.checked)}),label:"Paciente e responsável são a mesma pessoa"}),e.jsx(r,{label:"Nome do responsável (guardião legal)",value:j,onChange:t=>Me(t.target.value),placeholder:"Nome completo do responsável",fullWidth:!0}),e.jsx(r,{label:"Nome do paciente",value:W,onChange:t=>at(t.target.value),disabled:F,placeholder:F?"Igual ao responsável":"Nome completo do paciente",fullWidth:!0}),e.jsx(r,{label:"E-mail do responsável (opcional)",type:"email",value:P,onChange:t=>He(t.target.value),placeholder:"email@exemplo.com",fullWidth:!0}),e.jsx(r,{label:"CPF do responsável (obrigatório)",value:v,onChange:t=>Ve(t.target.value),placeholder:"Somente números (11 dígitos)",fullWidth:!0,required:P.trim()!=="",error:P.trim()!==""&&!!v.trim()&&!m(v),helperText:P.trim()!==""&&v.trim()&&!m(v)?"CPF inválido.":" "}),e.jsx(r,{label:"CPF do paciente (opcional)",type:Y?"text":"password",value:h,onChange:t=>Ue(t.target.value),placeholder:"Somente números (11 dígitos)",fullWidth:!0,error:!!h.trim()&&!m(h),helperText:h.trim()&&!m(h)?"CPF inválido.":" ",InputProps:{endAdornment:e.jsx(We,{position:"end",children:e.jsx(y,{onClick:()=>qe(t=>!t),edge:"end","aria-label":Y?"Ocultar CPF":"Mostrar CPF",children:Y?e.jsx(_e,{}):e.jsx(Ie,{})})})}}),e.jsx(C,{variant:"subtitle2",color:"text.secondary",children:"Endereço do responsável (obrigatório se e-mail preenchido)"}),e.jsx(r,{label:"Rua",value:Z,onChange:t=>$e(t.target.value),placeholder:"Rua, número, complemento",fullWidth:!0}),e.jsx(r,{label:"Bairro",value:ee,onChange:t=>Xe(t.target.value),fullWidth:!0}),e.jsxs(x,{sx:{display:"flex",gap:2,flexWrap:"wrap"},children:[e.jsx(r,{label:"Cidade",value:te,onChange:t=>Je(t.target.value),sx:{flex:1,minWidth:120}}),e.jsx(r,{label:"Estado",value:ae,onChange:t=>Ke(t.target.value),placeholder:"UF",inputProps:{maxLength:2},sx:{width:80}}),e.jsx(r,{label:"País",value:ie,onChange:t=>Qe(t.target.value),sx:{flex:1,minWidth:120}}),e.jsx(r,{label:"CEP",value:T,onChange:t=>Ye(t.target.value),placeholder:"00000000",inputProps:{maxLength:9},sx:{width:120}})]}),e.jsx(r,{label:"Data de nascimento do responsável (obrigatório se e-mail preenchido)",type:"date",value:re,onChange:t=>Ze(t.target.value),InputLabelProps:{shrink:!0},fullWidth:!0}),e.jsx(r,{label:"Telefone (WhatsApp)",value:et,onChange:t=>tt(t.target.value),placeholder:"+5511999999999",fullWidth:!0}),e.jsx(r,{label:"Data de nascimento do paciente (obrigatório se e-mail do responsável preenchido)",type:"date",value:ne,onChange:t=>it(t.target.value),InputLabelProps:{shrink:!0},fullWidth:!0}),L&&e.jsx(N,{severity:"error",children:L})]})})}),e.jsx(De,{open:Dt,onClose:()=>{K(!1),jt()},title:"Enviar invite para paciente",actions:e.jsxs(e.Fragment,{children:[e.jsx(p,{onClick:()=>{K(!1),jt()},color:"inherit",sx:{color:g},children:"Cancelar"}),e.jsx(p,{variant:"contained",onClick:async()=>{s(""),B("");const t=Te.trim(),i=Ae.trim();if(!i){s("Nome do responsável é obrigatório.");return}if(!t){s("E-mail do responsável é obrigatório.");return}if(!we.test(t)){s("E-mail do responsável inválido.");return}Q(!0);try{const o=await Qt(t,i);B(o.message||"Convite enviado por e-mail.")}catch(o){s((o==null?void 0:o.message)||"Falha ao enviar convite.")}finally{Q(!1)}},disabled:Oe,sx:{bgcolor:c,"&:hover":{bgcolor:c,opacity:.9}},children:Oe?"Enviando...":"Enviar convite"})]}),children:e.jsxs(x,{sx:{display:"flex",flexDirection:"column",gap:2,pt:.5},children:[L&&e.jsx(N,{severity:"error",children:L}),Re&&e.jsx(N,{severity:"success",children:Re}),e.jsx(C,{variant:"body2",color:"text.secondary",children:"Informe o nome e o e-mail do responsável legal. Ele receberá um link para completar CPF, endereço e datas."}),e.jsx(r,{label:"Nome completo do responsável",value:Ae,onChange:t=>Be(t.target.value),fullWidth:!0}),e.jsx(r,{label:"E-mail do responsável",type:"email",value:Te,onChange:t=>Le(t.target.value),fullWidth:!0})]})}),e.jsx(De,{open:Wt,onClose:q,title:"Editar paciente",actions:e.jsxs(e.Fragment,{children:[l&&Ee&&Se&&e.jsx(p,{variant:"outlined",color:"error",onClick:Lt,children:"Excluir responsável"}),e.jsx(p,{onClick:q,color:"inherit",sx:{color:g},children:"Cancelar"}),e.jsx(p,{variant:"contained",type:"submit",form:"edit-patient-form",disabled:xt,children:xt?"Salvando...":"Salvar"})]}),children:e.jsx("form",{id:"edit-patient-form",onSubmit:Bt,children:e.jsxs(x,{sx:{display:"flex",flexDirection:"column",gap:2,pt:.5},children:[e.jsx(r,{label:"Nome do paciente",value:se,onChange:t=>oe(t.target.value),required:!0,fullWidth:!0}),e.jsx(r,{label:"Data de nascimento",type:"date",value:lt,onChange:t=>le(t.target.value),InputLabelProps:{shrink:!0},fullWidth:!0}),e.jsx(r,{label:"E-mail do paciente (opcional)",type:"email",value:dt,onChange:t=>de(t.target.value),fullWidth:!0}),e.jsx(r,{label:"CPF do paciente (opcional)",type:ue?"text":"password",value:E,onChange:t=>ce(t.target.value),placeholder:"Somente números (11 dígitos)",fullWidth:!0,error:!!E.trim()&&!m(E),helperText:E.trim()&&!m(E)?"CPF inválido.":" ",InputProps:{endAdornment:e.jsx(We,{position:"end",children:e.jsx(y,{onClick:()=>ut(t=>!t),edge:"end","aria-label":ue?"Ocultar CPF":"Mostrar CPF",children:ue?e.jsx(_e,{}):e.jsx(Ie,{})})})}}),Ee&&e.jsxs(e.Fragment,{children:[e.jsx(C,{variant:"subtitle2",sx:{mt:1},children:"Responsável legal"}),e.jsx(r,{label:"Nome do responsável",value:mt,onChange:t=>me(t.target.value),fullWidth:!0}),e.jsx(r,{label:"E-mail do responsável",type:"email",value:R,onChange:t=>pe(t.target.value),fullWidth:!0}),e.jsx(r,{label:"Data de nascimento do responsável",type:"date",value:pt,onChange:t=>be(t.target.value),InputLabelProps:{shrink:!0},fullWidth:!0}),e.jsx(r,{label:"Telefone (WhatsApp)",value:ht,onChange:t=>je(t.target.value),placeholder:"+5511999999999",fullWidth:!0}),e.jsx(C,{variant:"subtitle2",color:"text.secondary",children:"Endereço"}),e.jsx(r,{label:"Rua",value:z,onChange:t=>he(t.target.value),placeholder:"Rua, número, complemento",fullWidth:!0}),e.jsx(r,{label:"Bairro",value:M,onChange:t=>fe(t.target.value),fullWidth:!0}),e.jsxs(x,{sx:{display:"flex",gap:2,flexWrap:"wrap"},children:[e.jsx(r,{label:"Cidade",value:H,onChange:t=>xe(t.target.value),sx:{flex:1,minWidth:120}}),e.jsx(r,{label:"Estado",value:V,onChange:t=>ge(t.target.value),placeholder:"UF",inputProps:{maxLength:2},sx:{width:80}}),e.jsx(r,{label:"País",value:U,onChange:t=>ve(t.target.value),sx:{flex:1,minWidth:120}}),e.jsx(r,{label:"CEP",value:w,onChange:t=>Ce(t.target.value),placeholder:"00000000",inputProps:{maxLength:9},sx:{width:120}})]}),e.jsx(r,{label:"CPF do responsável (deixe em branco para não alterar)",type:ye?"text":"password",value:f,onChange:t=>Pe(t.target.value),placeholder:"Somente números (11 dígitos)",fullWidth:!0,error:!!f.trim()&&!m(f),helperText:f.trim()&&!m(f)?"CPF inválido.":" ",InputProps:{endAdornment:e.jsx(We,{position:"end",children:e.jsx(y,{onClick:()=>bt(t=>!t),edge:"end","aria-label":ye?"Ocultar CPF":"Mostrar CPF",children:ye?e.jsx(_e,{}):e.jsx(Ie,{})})})}})]}),gt&&e.jsx(N,{severity:"error",children:gt})]})})})]})}export{Da as Patients};
