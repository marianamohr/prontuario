import{q as tt,t as lt,r,v as ot,w as ie,j as e,x as yt,y as st,z as be,A as jt,E as rt,h as Ct,F as Mt,G as Et,H as wt,J as It,K as Ve,M as kt,O as Je,Q as Ce,R as _t,S as Wt,u as Dt,c as zt,U as Ot,T as E,B as me,V as xe,P as Qe,I as at,W as Ut,X as $t,Y as it,Z as Ht,_ as Vt}from"./index-DJlnvih6.js";import{V as ct,a as dt}from"./VisibilityOff-BuKH-pgV.js";import{P as ut}from"./PageContainer-DrcGApUY.js";import{A as pt}from"./AppDialog-C8ethuMW.js";import{i as Fe}from"./cpf-Bdeebvjv.js";import{B as re}from"./Button-6qkZ5rwi.js";import{T as I}from"./TextField-CttgYVuf.js";import{F as ht,I as ft,S as mt}from"./Select-cu5oWY5i.js";import{T as Gt,a as Oe,b as Ue,c as O,d as p,e as $e}from"./TableRow-Bh5fPPOD.js";import{A as Ze}from"./Alert-CVqmUb3o.js";import{I as xt}from"./InputAdornment-KMMRGF9J.js";function Xt(o){return tt("MuiTab",o)}const U=lt("MuiTab",["root","labelIcon","textColorInherit","textColorPrimary","textColorSecondary","selected","disabled","fullWidth","wrapped","iconWrapper","icon"]),Kt=o=>{const{classes:l,textColor:a,fullWidth:h,wrapped:c,icon:f,label:v,selected:y,disabled:x}=o,P={root:["root",f&&v&&"labelIcon",`textColor${yt(a)}`,h&&"fullWidth",c&&"wrapped",y&&"selected",x&&"disabled"],icon:["iconWrapper","icon"]};return st(P,Xt,l)},Yt=be(jt,{name:"MuiTab",slot:"Root",overridesResolver:(o,l)=>{const{ownerState:a}=o;return[l.root,a.label&&a.icon&&l.labelIcon,l[`textColor${yt(a.textColor)}`],a.fullWidth&&l.fullWidth,a.wrapped&&l.wrapped,{[`& .${U.iconWrapper}`]:l.iconWrapper},{[`& .${U.icon}`]:l.icon}]}})(rt(({theme:o})=>({...o.typography.button,maxWidth:360,minWidth:90,position:"relative",minHeight:48,flexShrink:0,padding:"12px 16px",overflow:"hidden",whiteSpace:"normal",textAlign:"center",lineHeight:1.25,variants:[{props:({ownerState:l})=>l.label&&(l.iconPosition==="top"||l.iconPosition==="bottom"),style:{flexDirection:"column"}},{props:({ownerState:l})=>l.label&&l.iconPosition!=="top"&&l.iconPosition!=="bottom",style:{flexDirection:"row"}},{props:({ownerState:l})=>l.icon&&l.label,style:{minHeight:72,paddingTop:9,paddingBottom:9}},{props:({ownerState:l,iconPosition:a})=>l.icon&&l.label&&a==="top",style:{[`& > .${U.icon}`]:{marginBottom:6}}},{props:({ownerState:l,iconPosition:a})=>l.icon&&l.label&&a==="bottom",style:{[`& > .${U.icon}`]:{marginTop:6}}},{props:({ownerState:l,iconPosition:a})=>l.icon&&l.label&&a==="start",style:{[`& > .${U.icon}`]:{marginRight:o.spacing(1)}}},{props:({ownerState:l,iconPosition:a})=>l.icon&&l.label&&a==="end",style:{[`& > .${U.icon}`]:{marginLeft:o.spacing(1)}}},{props:{textColor:"inherit"},style:{color:"inherit",opacity:.6,[`&.${U.selected}`]:{opacity:1},[`&.${U.disabled}`]:{opacity:(o.vars||o).palette.action.disabledOpacity}}},{props:{textColor:"primary"},style:{color:(o.vars||o).palette.text.secondary,[`&.${U.selected}`]:{color:(o.vars||o).palette.primary.main},[`&.${U.disabled}`]:{color:(o.vars||o).palette.text.disabled}}},{props:{textColor:"secondary"},style:{color:(o.vars||o).palette.text.secondary,[`&.${U.selected}`]:{color:(o.vars||o).palette.secondary.main},[`&.${U.disabled}`]:{color:(o.vars||o).palette.text.disabled}}},{props:({ownerState:l})=>l.fullWidth,style:{flexShrink:1,flexGrow:1,flexBasis:0,maxWidth:"none"}},{props:({ownerState:l})=>l.wrapped,style:{fontSize:o.typography.pxToRem(12)}}]}))),bt=r.forwardRef(function(l,a){const h=ot({props:l,name:"MuiTab"}),{className:c,disabled:f=!1,disableFocusRipple:v=!1,fullWidth:y,icon:x,iconPosition:P="top",indicator:C,label:B,onChange:g,onClick:T,onFocus:L,selected:W,selectionFollowsFocus:R,textColor:ce="inherit",value:N,wrapped:Se=!1,...M}=h,Z={...h,disabled:f,disableFocusRipple:v,selected:W,icon:!!x,iconPosition:P,label:!!B,fullWidth:y,textColor:ce,wrapped:Se},$=Kt(Z),ne=x&&B&&r.isValidElement(x)?r.cloneElement(x,{className:ie($.icon,x.props.className)}):x,D=z=>{!W&&g&&g(z,N),T&&T(z)},G=z=>{R&&!W&&g&&g(z,N),L&&L(z)};return e.jsxs(Yt,{focusRipple:!v,className:ie($.root,c),ref:a,role:"tab","aria-selected":W,disabled:f,onClick:D,onFocus:G,ownerState:Z,tabIndex:W?0:-1,...M,children:[P==="top"||P==="start"?e.jsxs(r.Fragment,{children:[ne,B]}):e.jsxs(r.Fragment,{children:[B,ne]}),C]})}),qt=Ct(e.jsx("path",{d:"M15.41 16.09l-4.58-4.59 4.58-4.59L14 5.5l-6 6 6 6z"})),Jt=Ct(e.jsx("path",{d:"M8.59 16.34l4.58-4.59-4.58-4.59L10 5.75l6 6-6 6z"}));function Qt(o){return(1+Math.sin(Math.PI*o-Math.PI/2))/2}function Zt(o,l,a,h={},c=()=>{}){const{ease:f=Qt,duration:v=300}=h;let y=null;const x=l[o];let P=!1;const C=()=>{P=!0},B=g=>{if(P){c(new Error("Animation cancelled"));return}y===null&&(y=g);const T=Math.min(1,(g-y)/v);if(l[o]=f(T)*(a-x)+x,T>=1){requestAnimationFrame(()=>{c(null)});return}requestAnimationFrame(B)};return x===a?(c(new Error("Element already at target position")),C):(requestAnimationFrame(B),C)}const el={width:99,height:99,position:"absolute",top:-9999,overflow:"scroll"};function tl(o){const{onChange:l,...a}=o,h=r.useRef(),c=r.useRef(null),f=()=>{h.current=c.current.offsetHeight-c.current.clientHeight};return Mt(()=>{const v=Et(()=>{const x=h.current;f(),x!==h.current&&l(h.current)}),y=wt(c.current);return y.addEventListener("resize",v),()=>{v.clear(),y.removeEventListener("resize",v)}},[l]),r.useEffect(()=>{f(),l(h.current)},[l]),e.jsx("div",{style:el,...a,ref:c})}function ll(o){return tt("MuiTabScrollButton",o)}const ol=lt("MuiTabScrollButton",["root","vertical","horizontal","disabled"]),sl=o=>{const{classes:l,orientation:a,disabled:h}=o;return st({root:["root",a,h&&"disabled"]},ll,l)},rl=be(jt,{name:"MuiTabScrollButton",slot:"Root",overridesResolver:(o,l)=>{const{ownerState:a}=o;return[l.root,a.orientation&&l[a.orientation]]}})({width:40,flexShrink:0,opacity:.8,[`&.${ol.disabled}`]:{opacity:0},variants:[{props:{orientation:"vertical"},style:{width:"100%",height:40,"& svg":{transform:"var(--TabScrollButton-svgRotate)"}}}]}),nl=r.forwardRef(function(l,a){const h=ot({props:l,name:"MuiTabScrollButton"}),{className:c,slots:f={},slotProps:v={},direction:y,orientation:x,disabled:P,...C}=h,B=It(),g={isRtl:B,...h},T=sl(g),L=f.StartScrollButtonIcon??qt,W=f.EndScrollButtonIcon??Jt,R=Ve({elementType:L,externalSlotProps:v.startScrollButtonIcon,additionalProps:{fontSize:"small"},ownerState:g}),ce=Ve({elementType:W,externalSlotProps:v.endScrollButtonIcon,additionalProps:{fontSize:"small"},ownerState:g});return e.jsx(rl,{component:"div",className:ie(T.root,c),ref:a,role:null,ownerState:g,tabIndex:null,...C,style:{...C.style,...x==="vertical"&&{"--TabScrollButton-svgRotate":`rotate(${B?-90:90}deg)`}},children:y==="left"?e.jsx(L,{...R}):e.jsx(W,{...ce})})});function al(o){return tt("MuiTabs",o)}const et=lt("MuiTabs",["root","vertical","list","flexContainer","flexContainerVertical","centered","scroller","fixed","scrollableX","scrollableY","hideScrollbar","scrollButtons","scrollButtonsHideMobile","indicator"]),St=(o,l)=>o===l?o.firstChild:l&&l.nextElementSibling?l.nextElementSibling:o.firstChild,vt=(o,l)=>o===l?o.lastChild:l&&l.previousElementSibling?l.previousElementSibling:o.lastChild,He=(o,l,a)=>{let h=!1,c=a(o,l);for(;c;){if(c===o.firstChild){if(h)return;h=!0}const f=c.disabled||c.getAttribute("aria-disabled")==="true";if(!c.hasAttribute("tabindex")||f)c=a(o,c);else{c.focus();return}}},il=o=>{const{vertical:l,fixed:a,hideScrollbar:h,scrollableX:c,scrollableY:f,centered:v,scrollButtonsHideMobile:y,classes:x}=o;return st({root:["root",l&&"vertical"],scroller:["scroller",a&&"fixed",h&&"hideScrollbar",c&&"scrollableX",f&&"scrollableY"],list:["list","flexContainer",l&&"flexContainerVertical",l&&"vertical",v&&"centered"],indicator:["indicator"],scrollButtons:["scrollButtons",y&&"scrollButtonsHideMobile"],scrollableX:[c&&"scrollableX"],hideScrollbar:[h&&"hideScrollbar"]},al,x)},cl=be("div",{name:"MuiTabs",slot:"Root",overridesResolver:(o,l)=>{const{ownerState:a}=o;return[{[`& .${et.scrollButtons}`]:l.scrollButtons},{[`& .${et.scrollButtons}`]:a.scrollButtonsHideMobile&&l.scrollButtonsHideMobile},l.root,a.vertical&&l.vertical]}})(rt(({theme:o})=>({overflow:"hidden",minHeight:48,WebkitOverflowScrolling:"touch",display:"flex",variants:[{props:({ownerState:l})=>l.vertical,style:{flexDirection:"column"}},{props:({ownerState:l})=>l.scrollButtonsHideMobile,style:{[`& .${et.scrollButtons}`]:{[o.breakpoints.down("sm")]:{display:"none"}}}}]}))),dl=be("div",{name:"MuiTabs",slot:"Scroller",overridesResolver:(o,l)=>{const{ownerState:a}=o;return[l.scroller,a.fixed&&l.fixed,a.hideScrollbar&&l.hideScrollbar,a.scrollableX&&l.scrollableX,a.scrollableY&&l.scrollableY]}})({position:"relative",display:"inline-block",flex:"1 1 auto",whiteSpace:"nowrap",variants:[{props:({ownerState:o})=>o.fixed,style:{overflowX:"hidden",width:"100%"}},{props:({ownerState:o})=>o.hideScrollbar,style:{scrollbarWidth:"none","&::-webkit-scrollbar":{display:"none"}}},{props:({ownerState:o})=>o.scrollableX,style:{overflowX:"auto",overflowY:"hidden"}},{props:({ownerState:o})=>o.scrollableY,style:{overflowY:"auto",overflowX:"hidden"}}]}),ul=be("div",{name:"MuiTabs",slot:"List",overridesResolver:(o,l)=>{const{ownerState:a}=o;return[l.list,l.flexContainer,a.vertical&&l.flexContainerVertical,a.centered&&l.centered]}})({display:"flex",variants:[{props:({ownerState:o})=>o.vertical,style:{flexDirection:"column"}},{props:({ownerState:o})=>o.centered,style:{justifyContent:"center"}}]}),pl=be("span",{name:"MuiTabs",slot:"Indicator"})(rt(({theme:o})=>({position:"absolute",height:2,bottom:0,width:"100%",transition:o.transitions.create(),variants:[{props:{indicatorColor:"primary"},style:{backgroundColor:(o.vars||o).palette.primary.main}},{props:{indicatorColor:"secondary"},style:{backgroundColor:(o.vars||o).palette.secondary.main}},{props:({ownerState:l})=>l.vertical,style:{height:"100%",width:2,right:0}}]}))),hl=be(tl)({overflowX:"auto",overflowY:"hidden",scrollbarWidth:"none","&::-webkit-scrollbar":{display:"none"}}),gt={},fl=r.forwardRef(function(l,a){const h=ot({props:l,name:"MuiTabs"}),c=kt(),f=It(),{"aria-label":v,"aria-labelledby":y,action:x,centered:P=!1,children:C,className:B,component:g="div",allowScrollButtonsMobile:T=!1,indicatorColor:L="primary",onChange:W,orientation:R="horizontal",ScrollButtonComponent:ce,scrollButtons:N="auto",selectionFollowsFocus:Se,slots:M={},slotProps:Z={},TabIndicatorProps:$={},TabScrollButtonProps:ne={},textColor:D="primary",value:G,variant:z="standard",visibleScrollbar:ae=!1,...Ge}=h,w=z==="scrollable",A=R==="vertical",H=A?"scrollTop":"scrollLeft",ee=A?"top":"left",te=A?"bottom":"right",k=A?"clientHeight":"clientWidth",X=A?"height":"width",b={...h,component:g,allowScrollButtonsMobile:T,indicatorColor:L,orientation:R,vertical:A,scrollButtons:N,textColor:D,variant:z,visibleScrollbar:ae,fixed:!w,hideScrollbar:w&&!ae,scrollableX:w&&!A,scrollableY:w&&A,centered:P&&!w,scrollButtonsHideMobile:!T},_=il(b),Le=Ve({elementType:M.StartScrollButtonIcon,externalSlotProps:Z.startScrollButtonIcon,ownerState:b}),Ne=Ve({elementType:M.EndScrollButtonIcon,externalSlotProps:Z.endScrollButtonIcon,ownerState:b}),[Ee,K]=r.useState(!1),[V,ve]=r.useState(gt),[ge,we]=r.useState(!1),[ye,Ie]=r.useState(!1),[Pe,Be]=r.useState(!1),[de,je]=r.useState({overflow:"hidden",scrollbarWidth:0}),ue=new Map,F=r.useRef(null),Y=r.useRef(null),q={slots:M,slotProps:{indicator:$,scrollButtons:ne,...Z}},Te=()=>{const s=F.current;let n;if(s){const d=s.getBoundingClientRect();n={clientWidth:s.clientWidth,scrollLeft:s.scrollLeft,scrollTop:s.scrollTop,scrollWidth:s.scrollWidth,top:d.top,bottom:d.bottom,left:d.left,right:d.right}}let i;if(s&&G!==!1){const d=Y.current.children;if(d.length>0){const S=d[ue.get(G)];i=S?S.getBoundingClientRect():null}}return{tabsMeta:n,tabMeta:i}},le=Je(()=>{const{tabsMeta:s,tabMeta:n}=Te();let i=0,d;A?(d="top",n&&s&&(i=n.top-s.top+s.scrollTop)):(d=f?"right":"left",n&&s&&(i=(f?-1:1)*(n[d]-s[d]+s.scrollLeft)));const S={[d]:i,[X]:n?n[X]:0};if(typeof V[d]!="number"||typeof V[X]!="number")ve(S);else{const Q=Math.abs(V[d]-S[d]),fe=Math.abs(V[X]-S[X]);(Q>=1||fe>=1)&&ve(S)}}),j=(s,{animation:n=!0}={})=>{n?Zt(H,F.current,s,{duration:c.transitions.duration.standard}):F.current[H]=s},pe=s=>{let n=F.current[H];A?n+=s:n+=s*(f?-1:1),j(n)},oe=()=>{const s=F.current[k];let n=0;const i=Array.from(Y.current.children);for(let d=0;d<i.length;d+=1){const S=i[d];if(n+S[k]>s){d===0&&(n=s);break}n+=S[k]}return n},he=()=>{pe(-1*oe())},Re=()=>{pe(oe())},[Me,{onChange:se,...ke}]=Ce("scrollbar",{className:ie(_.scrollableX,_.hideScrollbar),elementType:hl,shouldForwardComponentProp:!0,externalForwardedProps:q,ownerState:b}),Xe=r.useCallback(s=>{se==null||se(s),je({overflow:null,scrollbarWidth:s})},[se]),[_e,We]=Ce("scrollButtons",{className:ie(_.scrollButtons,ne.className),elementType:nl,externalForwardedProps:q,ownerState:b,additionalProps:{orientation:R,slots:{StartScrollButtonIcon:M.startScrollButtonIcon||M.StartScrollButtonIcon,EndScrollButtonIcon:M.endScrollButtonIcon||M.EndScrollButtonIcon},slotProps:{startScrollButtonIcon:Le,endScrollButtonIcon:Ne}}}),Ke=()=>{const s={};s.scrollbarSizeListener=w?e.jsx(Me,{...ke,onChange:Xe}):null;const i=w&&(N==="auto"&&(ge||ye)||N===!0);return s.scrollButtonStart=i?e.jsx(_e,{direction:f?"right":"left",onClick:he,disabled:!ge,...We}):null,s.scrollButtonEnd=i?e.jsx(_e,{direction:f?"left":"right",onClick:Re,disabled:!ye,...We}):null,s},De=Je(s=>{const{tabsMeta:n,tabMeta:i}=Te();if(!(!i||!n)){if(i[ee]<n[ee]){const d=n[H]+(i[ee]-n[ee]);j(d,{animation:s})}else if(i[te]>n[te]){const d=n[H]+(i[te]-n[te]);j(d,{animation:s})}}}),t=Je(()=>{w&&N!==!1&&Be(!Pe)});r.useEffect(()=>{const s=Et(()=>{F.current&&le()});let n;const i=Q=>{Q.forEach(fe=>{fe.removedNodes.forEach(Ae=>{n==null||n.unobserve(Ae)}),fe.addedNodes.forEach(Ae=>{n==null||n.observe(Ae)})}),s(),t()},d=wt(F.current);d.addEventListener("resize",s);let S;return typeof ResizeObserver<"u"&&(n=new ResizeObserver(s),Array.from(Y.current.children).forEach(Q=>{n.observe(Q)})),typeof MutationObserver<"u"&&(S=new MutationObserver(i),S.observe(Y.current,{childList:!0})),()=>{s.clear(),d.removeEventListener("resize",s),S==null||S.disconnect(),n==null||n.disconnect()}},[le,t]),r.useEffect(()=>{const s=Array.from(Y.current.children),n=s.length;if(typeof IntersectionObserver<"u"&&n>0&&w&&N!==!1){const i=s[0],d=s[n-1],S={root:F.current,threshold:.99},Q=qe=>{we(!qe[0].isIntersecting)},fe=new IntersectionObserver(Q,S);fe.observe(i);const Ae=qe=>{Ie(!qe[0].isIntersecting)},nt=new IntersectionObserver(Ae,S);return nt.observe(d),()=>{fe.disconnect(),nt.disconnect()}}},[w,N,Pe,C==null?void 0:C.length]),r.useEffect(()=>{K(!0)},[]),r.useEffect(()=>{le()}),r.useEffect(()=>{De(gt!==V)},[De,V]),r.useImperativeHandle(x,()=>({updateIndicator:le,updateScrollButtons:t}),[le,t]);const[u,m]=Ce("indicator",{className:ie(_.indicator,$.className),elementType:pl,externalForwardedProps:q,ownerState:b,additionalProps:{style:V}}),J=e.jsx(u,{...m});let ze=0;const Pt=r.Children.map(C,s=>{if(!r.isValidElement(s))return null;const n=s.props.value===void 0?ze:s.props.value;ue.set(n,ze);const i=n===G;return ze+=1,r.cloneElement(s,{fullWidth:z==="fullWidth",indicator:i&&!Ee&&J,selected:i,selectionFollowsFocus:Se,onChange:W,textColor:D,value:n,...ze===1&&G===!1&&!s.props.tabIndex?{tabIndex:0}:{}})}),Bt=s=>{if(s.altKey||s.shiftKey||s.ctrlKey||s.metaKey)return;const n=Y.current,i=_t(Wt(n));if((i==null?void 0:i.getAttribute("role"))!=="tab")return;let S=R==="horizontal"?"ArrowLeft":"ArrowUp",Q=R==="horizontal"?"ArrowRight":"ArrowDown";switch(R==="horizontal"&&f&&(S="ArrowRight",Q="ArrowLeft"),s.key){case S:s.preventDefault(),He(n,i,vt);break;case Q:s.preventDefault(),He(n,i,St);break;case"Home":s.preventDefault(),He(n,null,St);break;case"End":s.preventDefault(),He(n,null,vt);break}},Ye=Ke(),[Tt,Rt]=Ce("root",{ref:a,className:ie(_.root,B),elementType:cl,externalForwardedProps:{...q,...Ge,component:g},ownerState:b}),[At,Ft]=Ce("scroller",{ref:F,className:_.scroller,elementType:dl,externalForwardedProps:q,ownerState:b,additionalProps:{style:{overflow:de.overflow,[A?`margin${f?"Left":"Right"}`:"marginBottom"]:ae?void 0:-de.scrollbarWidth}}}),[Lt,Nt]=Ce("list",{ref:Y,className:ie(_.list,_.flexContainer),elementType:ul,externalForwardedProps:q,ownerState:b,getSlotProps:s=>({...s,onKeyDown:n=>{var i;Bt(n),(i=s.onKeyDown)==null||i.call(s,n)}})});return e.jsxs(Tt,{...Rt,children:[Ye.scrollButtonStart,Ye.scrollbarSizeListener,e.jsxs(At,{...Ft,children:[e.jsx(Lt,{"aria-label":v,"aria-labelledby":y,"aria-orientation":R==="vertical"?"vertical":null,role:"tablist",...Nt,children:Pt}),Ee&&J]}),Ye.scrollButtonEnd]})});function Il(){const{user:o}=Dt(),l=zt(),[a,h]=r.useState([]),[c,f]=r.useState(!0),[v,y]=r.useState(""),[x,P]=r.useState(""),[C,B]=r.useState(""),[g,T]=r.useState("users"),[L,W]=r.useState(null),[R,ce]=r.useState(!1),[N,Se]=r.useState(""),[M,Z]=r.useState([]),[$,ne]=r.useState([]),[D,G]=r.useState(null),[z,ae]=r.useState([]),[Ge,w]=r.useState(!1),[A,H]=r.useState(""),[ee,te]=r.useState(""),[k,X]=r.useState(null),[b,_]=r.useState(null),[Le,Ne]=r.useState(!1),[Ee,K]=r.useState(""),[V,ve]=r.useState(""),[ge,we]=r.useState(""),[ye,Ie]=r.useState(""),[Pe,Be]=r.useState("ACTIVE"),[de,je]=r.useState(""),[ue,F]=r.useState(""),[Y,q]=r.useState(""),[Te,le]=r.useState(""),[j,pe]=r.useState(""),[oe,he]=r.useState(!1),[Re,Me]=r.useState(""),se=r.useCallback(()=>{f(!0),Ot().then(t=>h(t.users)).finally(()=>f(!1))},[]);r.useEffect(()=>{(o==null?void 0:o.role)==="SUPER_ADMIN"&&se()},[o==null?void 0:o.role,se]);const ke=a.filter(t=>{const u=!v.trim()||(t.full_name||"").toLowerCase().includes(v.trim().toLowerCase()),m=!x.trim()||(t.id||"").toLowerCase().includes(x.trim().toLowerCase()),J=!C||t.type===C;return u&&m&&J}),Xe=async t=>{if(t.type==="PROFESSIONAL"){W(t),T("related"),ce(!0),Se(""),Z([]),ne([]),G(null),ae([]),H("");try{const u=await $t(t.id);if(Z(u.patients||[]),ne(u.guardians||[]),(u.patients||[]).length>0){const m=u.patients[0];G({id:m.id,full_name:m.full_name}),w(!0),H(""),it(m.id).then(J=>ae(J.guardians||[])).catch(J=>H((J==null?void 0:J.message)||"Falha ao carregar responsáveis do paciente.")).finally(()=>w(!1))}}catch(u){Se((u==null?void 0:u.message)||"Falha ao carregar dados relacionados.")}finally{ce(!1)}}},_e=async t=>{G({id:t.id,full_name:t.full_name}),w(!0),H(""),ae([]);try{const u=await it(t.id);ae(u.guardians||[])}catch(u){H((u==null?void 0:u.message)||"Falha ao carregar responsáveis do paciente.")}finally{w(!1)}},We=async()=>{if(!(!k||!ee.trim()))try{const t=localStorage.getItem("token"),u=localStorage.getItem("user");t&&localStorage.setItem("impersonate_admin_token",t),u&&localStorage.setItem("impersonate_admin_user",u);const m=await Ht(k.type,k.id,ee.trim());localStorage.setItem("token",m.token),localStorage.setItem("impersonating","1"),localStorage.setItem("user",JSON.stringify({...o,role:k.type,id:k.id})),X(null),te(""),window.location.href="/patients"}catch{localStorage.removeItem("impersonate_admin_token"),localStorage.removeItem("impersonate_admin_user"),alert("Falha ao iniciar impersonate.")}},Ke=async t=>{K(""),Ne(!0),_({type:t.type,id:t.id}),ve(t.email),we(t.full_name),Ie(""),Be(t.status||"ACTIVE"),je(""),F(""),q(""),le(""),pe(""),he(!1),Me(""),setEditMeta(null);try{const m=(await Ut(t.type,t.id)).user;ve(m.email||t.email),we(m.full_name||t.full_name),Ie(m.trade_name?String(m.trade_name):""),Be(m.status||t.status||"ACTIVE"),je(m.birth_date?String(m.birth_date):""),F(m.address?String(m.address):""),q(m.phone?String(m.phone):""),le(m.marital_status?String(m.marital_status):""),pe(m.cpf?String(m.cpf):"")}catch{K("Falha ao carregar detalhes do usuário.")}finally{Ne(!1)}},De=async()=>{if(b){if(K(""),!V.trim()||!ge.trim()){K("E-mail e nome são obrigatórios.");return}if(j.trim()&&!Fe(j)){K("CPF inválido.");return}try{const t={email:V.trim(),full_name:ge.trim(),status:Pe};b.type==="PROFESSIONAL"?(ye.trim()&&(t.trade_name=ye.trim()),t.birth_date=de.trim(),t.address=ue,t.marital_status=Te):b.type==="LEGAL_GUARDIAN"&&(t.birth_date=de.trim(),t.address=ue,t.phone=Y.trim()),j.trim()&&(t.cpf=j.trim()),Re.trim()&&(t.new_password=Re),await Vt(b.type,b.id,t),await se(),_(null)}catch(t){const u=String((t==null?void 0:t.message)||"");K(u.includes("email")||u.includes("cpf")?u:"Falha ao salvar alterações.")}}};return(o==null?void 0:o.role)!=="SUPER_ADMIN"?e.jsx(ut,{children:e.jsx(E,{children:"Acesso negado. Apenas super admin."})}):e.jsxs(ut,{children:[e.jsx(E,{variant:"h4",sx:{mb:1.5},children:"Usuários"}),e.jsxs(fl,{value:g,onChange:(t,u)=>T(u),sx:{mb:2},children:[e.jsx(bt,{value:"users",label:"Usuários"}),e.jsx(bt,{value:"related",label:L?`Profissional: ${L.full_name}`:"Profissional: relacionados",disabled:!L})]}),g==="related"&&L&&e.jsx(me,{sx:{mb:2},children:e.jsx(re,{variant:"outlined",onClick:()=>T("users"),children:"Voltar"})}),e.jsx(me,{sx:{mb:2,display:"flex",gap:1,flexWrap:"wrap"},children:e.jsx(re,{variant:"contained",onClick:()=>l("/backoffice/invites"),children:"Enviar convite para profissional"})}),e.jsx(me,{sx:{mb:2},children:e.jsx(re,{variant:"outlined",size:"small",onClick:se,children:"Atualizar"})}),g==="users"&&e.jsxs(e.Fragment,{children:[e.jsxs(me,{sx:{display:"flex",gap:1,flexWrap:"wrap",mb:2},children:[e.jsx(I,{size:"small",label:"Filtrar por nome",value:v,onChange:t=>y(t.target.value)}),e.jsx(I,{size:"small",label:"Filtrar por ID",value:x,onChange:t=>P(t.target.value),sx:{minWidth:260}}),e.jsxs(ht,{size:"small",sx:{minWidth:200},children:[e.jsx(ft,{children:"Tipo"}),e.jsxs(mt,{value:C,label:"Tipo",onChange:t=>B(String(t.target.value)),children:[e.jsx(xe,{value:"",children:"Todos"}),e.jsx(xe,{value:"PROFESSIONAL",children:"PROFESSIONAL"}),e.jsx(xe,{value:"LEGAL_GUARDIAN",children:"LEGAL_GUARDIAN"}),e.jsx(xe,{value:"SUPER_ADMIN",children:"SUPER_ADMIN"})]})]})]}),c&&e.jsx(E,{color:"text.secondary",children:"Carregando..."}),!c&&e.jsx(Gt,{component:Qe,variant:"outlined",children:e.jsxs(Oe,{size:"small",children:[e.jsx(Ue,{children:e.jsxs(O,{children:[e.jsx(p,{children:"Tipo"}),e.jsx(p,{children:"Nome"}),e.jsx(p,{children:"E-mail"}),e.jsx(p,{children:"Status"}),e.jsx(p,{children:"Ação"})]})}),e.jsxs($e,{children:[ke.map(t=>e.jsxs(O,{hover:!0,onClick:()=>Xe(t),sx:{cursor:t.type==="PROFESSIONAL"?"pointer":"default"},title:t.type==="PROFESSIONAL"?"Clique para ver pacientes e responsáveis desta clínica":void 0,children:[e.jsx(p,{children:t.type}),e.jsx(p,{children:t.full_name}),e.jsx(p,{children:t.email}),e.jsx(p,{children:t.status}),e.jsxs(p,{onClick:u=>u.stopPropagation(),children:[(t.type==="PROFESSIONAL"||t.type==="LEGAL_GUARDIAN")&&e.jsx(re,{size:"small",variant:"outlined",sx:{mr:1},onClick:()=>Ke(t),children:"Editar"}),t.type!=="SUPER_ADMIN"&&e.jsx(re,{size:"small",variant:"outlined",onClick:()=>X({type:t.type,id:t.id}),children:"Impersonate"})]})]},`${t.type}-${t.id}`)),ke.length===0&&e.jsx(O,{children:e.jsx(p,{colSpan:5,children:e.jsx(E,{color:"text.secondary",children:"Nenhum usuário encontrado para os filtros informados."})})})]})]})})]}),g==="related"&&L&&e.jsxs(e.Fragment,{children:[N&&e.jsx(Ze,{severity:"error",sx:{mb:2},children:N}),R&&e.jsx(E,{color:"text.secondary",children:"Carregando dados relacionados..."}),!R&&!N&&e.jsxs(me,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",md:"1fr 1fr"},gap:2},children:[e.jsxs(Qe,{variant:"outlined",sx:{p:2},children:[e.jsxs(E,{variant:"h6",sx:{mb:1},children:["Pacientes (",M.length,")"]}),e.jsxs(Oe,{size:"small",children:[e.jsx(Ue,{children:e.jsxs(O,{children:[e.jsx(p,{children:"Nome"}),e.jsx(p,{children:"Nasc."}),e.jsx(p,{children:"ID"})]})}),e.jsxs($e,{children:[M.map(t=>e.jsxs(O,{hover:!0,onClick:()=>_e({id:t.id,full_name:t.full_name}),sx:{cursor:"pointer"},selected:(D==null?void 0:D.id)===t.id,children:[e.jsx(p,{children:t.full_name}),e.jsx(p,{sx:{whiteSpace:"nowrap"},children:t.birth_date?new Date(String(t.birth_date)).toLocaleDateString("pt-BR"):"—"}),e.jsx(p,{sx:{fontFamily:"monospace",fontSize:12},children:t.id})]},t.id)),M.length===0&&e.jsx(O,{children:e.jsx(p,{colSpan:3,children:e.jsx(E,{color:"text.secondary",children:"Nenhum paciente."})})})]})]})]}),e.jsxs(Qe,{variant:"outlined",sx:{p:2},children:[e.jsx(E,{variant:"h6",sx:{mb:1},children:D?"Responsáveis legais do paciente":"Responsáveis legais"}),D&&e.jsxs(E,{variant:"body2",color:"text.secondary",sx:{mb:1},children:["Paciente: ",e.jsx("b",{children:D.full_name})]}),A&&e.jsx(Ze,{severity:"error",sx:{mb:1.5},children:A}),Ge?e.jsx(E,{color:"text.secondary",children:"Carregando responsáveis..."}):D?e.jsxs(Oe,{size:"small",children:[e.jsx(Ue,{children:e.jsxs(O,{children:[e.jsx(p,{children:"Nome"}),e.jsx(p,{children:"E-mail"}),e.jsx(p,{children:"Relação"})]})}),e.jsxs($e,{children:[z.map(t=>e.jsxs(O,{children:[e.jsx(p,{children:t.full_name}),e.jsx(p,{children:t.email}),e.jsx(p,{sx:{whiteSpace:"nowrap"},children:t.relation})]},t.id)),z.length===0&&e.jsx(O,{children:e.jsx(p,{colSpan:3,children:e.jsx(E,{color:"text.secondary",children:"Nenhum responsável vinculado a este paciente."})})})]})]}):e.jsx(E,{color:"text.secondary",children:"Selecione um paciente para ver o responsável legal."}),e.jsxs(me,{sx:{mt:2},children:[e.jsxs(E,{variant:"subtitle2",color:"text.secondary",sx:{mb:1},children:["Resumo de responsáveis na clínica (",$.length,")"]}),e.jsxs(Oe,{size:"small",children:[e.jsx(Ue,{children:e.jsxs(O,{children:[e.jsx(p,{children:"Nome"}),e.jsx(p,{children:"Pacientes"})]})}),e.jsxs($e,{children:[$.slice(0,10).map(t=>e.jsxs(O,{children:[e.jsx(p,{children:t.full_name}),e.jsx(p,{sx:{whiteSpace:"nowrap"},children:t.patients_count})]},t.id)),$.length===0&&e.jsx(O,{children:e.jsx(p,{colSpan:2,children:e.jsx(E,{color:"text.secondary",children:"Nenhum responsável."})})})]})]}),$.length>10&&e.jsxs(E,{variant:"caption",color:"text.secondary",children:["Mostrando 10 de ",$.length,". (Clique em um paciente para ver os responsáveis específicos.)"]})]})]})]})]}),e.jsx(pt,{open:!!k,onClose:()=>{X(null),te("")},title:"Impersonate – motivo obrigatório",actions:e.jsxs(e.Fragment,{children:[e.jsx(re,{onClick:()=>{X(null),te("")},color:"inherit",children:"Cancelar"}),e.jsx(re,{variant:"contained",onClick:We,disabled:!ee.trim(),children:"Iniciar impersonate"})]}),children:k&&e.jsxs(e.Fragment,{children:[e.jsxs(E,{sx:{mb:1},children:["Alvo: ",k.type," / ",k.id]}),e.jsx(I,{fullWidth:!0,multiline:!0,rows:3,label:"Motivo",placeholder:"Ex.: Suporte ticket #123",value:ee,onChange:t=>te(t.target.value)})]})}),e.jsx(pt,{open:!!b,onClose:()=>{_(null),K(""),he(!1)},title:b?`Editar usuário (${b.type})`:"Editar usuário",maxWidth:"sm",actions:e.jsxs(e.Fragment,{children:[e.jsx(re,{onClick:()=>{_(null),K(""),he(!1)},color:"inherit",children:"Cancelar"}),e.jsx(re,{variant:"contained",onClick:De,disabled:Le,children:Le?"Carregando...":"Salvar"})]}),children:e.jsxs(me,{sx:{display:"flex",flexDirection:"column",gap:2,pt:.5},children:[Ee&&e.jsx(Ze,{severity:"error",children:Ee}),e.jsx(I,{label:"E-mail",value:V,onChange:t=>ve(t.target.value),fullWidth:!0}),e.jsx(I,{label:"Nome",value:ge,onChange:t=>we(t.target.value),fullWidth:!0}),e.jsxs(ht,{fullWidth:!0,children:[e.jsx(ft,{id:"status-label",children:"Status"}),e.jsxs(mt,{labelId:"status-label",label:"Status",value:Pe,onChange:t=>Be(String(t.target.value)),children:[e.jsx(xe,{value:"ACTIVE",children:"ACTIVE"}),e.jsx(xe,{value:"SUSPENDED",children:"SUSPENDED"}),e.jsx(xe,{value:"CANCELLED",children:"CANCELLED"})]})]}),(b==null?void 0:b.type)==="PROFESSIONAL"&&e.jsxs(e.Fragment,{children:[e.jsx(I,{label:"Nome fantasia",value:ye,onChange:t=>Ie(t.target.value),fullWidth:!0}),e.jsx(I,{label:"Data de nascimento",type:"date",value:de,onChange:t=>je(t.target.value),InputLabelProps:{shrink:!0},fullWidth:!0}),e.jsx(I,{label:"CPF (opcional, para alterar)",type:oe?"text":"password",value:j,onChange:t=>pe(t.target.value),placeholder:"Somente números",fullWidth:!0,autoComplete:"off",inputMode:"numeric",error:!!j.trim()&&!Fe(j),helperText:j.trim()&&!Fe(j)?"CPF inválido.":" ",InputProps:{endAdornment:e.jsx(xt,{position:"end",children:e.jsx(at,{onClick:()=>he(t=>!t),edge:"end","aria-label":oe?"Ocultar CPF":"Mostrar CPF",children:oe?e.jsx(ct,{}):e.jsx(dt,{})})})}}),e.jsx(I,{label:"Endereço",value:ue,onChange:t=>F(t.target.value),multiline:!0,minRows:2,fullWidth:!0}),e.jsx(I,{label:"Estado civil",value:Te,onChange:t=>le(t.target.value),fullWidth:!0})]}),(b==null?void 0:b.type)==="LEGAL_GUARDIAN"&&e.jsxs(e.Fragment,{children:[e.jsx(I,{label:"Data de nascimento",type:"date",value:de,onChange:t=>je(t.target.value),InputLabelProps:{shrink:!0},fullWidth:!0}),e.jsx(I,{label:"Endereço",value:ue,onChange:t=>F(t.target.value),multiline:!0,minRows:2,fullWidth:!0}),e.jsx(I,{label:"Telefone (WhatsApp)",value:Y,onChange:t=>q(t.target.value),placeholder:"+5511999999999",fullWidth:!0}),e.jsx(I,{label:"CPF (opcional, para alterar)",type:oe?"text":"password",value:j,onChange:t=>pe(t.target.value),placeholder:"Somente números",fullWidth:!0,autoComplete:"off",inputMode:"numeric",error:!!j.trim()&&!Fe(j),helperText:j.trim()&&!Fe(j)?"CPF inválido.":" ",InputProps:{endAdornment:e.jsx(xt,{position:"end",children:e.jsx(at,{onClick:()=>he(t=>!t),edge:"end","aria-label":oe?"Ocultar CPF":"Mostrar CPF",children:oe?e.jsx(ct,{}):e.jsx(dt,{})})})}})]}),e.jsx(I,{label:"Nova senha (opcional)",type:"password",value:Re,onChange:t=>Me(t.target.value),placeholder:"mín. 8 caracteres",fullWidth:!0})]})})]})}export{Il as Backoffice};
